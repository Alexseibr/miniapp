# Codex Prompts ‚Äì Stage 6.7‚Äì6.8

These are ready-to-use prompts for Codex to continue development of KETMAR Market. Copy each block directly when invoking Codex.

## 6.7.1 ‚Äî Bot Favorites Integration
```
üîß –ü–†–û–ú–ü–¢ –î–õ–Ø CODEX ‚Äî –≠–¢–ê–ü 6.7.1 (–±–æ—Ç: –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)

–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å:

backend —Å REST API:

POST /api/favorites (body: { adId }) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ,

DELETE /api/favorites/:adId ‚Äî —É–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ,

GET /api/favorites ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,

Telegram-–±–æ—Ç –Ω–∞ Telegraf, –≤ —Ñ–∞–π–ª–µ bot/bot.js, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ:

–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ startBot() –∏–∑ index.js,

—É–º–µ–µ—Ç /start, /myid, /categories, /new_test_ad.

–ó–∞–¥–∞—á–∞:

–î–æ–±–∞–≤–∏—Ç—å –≤ bot/bot.js –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–º–∞–Ω–¥ –∏ inline-–∫–Ω–æ–ø–æ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º:

/fav_list ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ ctx.from.id.

inline-–∫–Ω–æ–ø–∫—É –ø–æ–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º –≤–∏–¥–∞ ‚Äú‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ‚Äù / ‚Äú‚úñ –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ‚Äù.

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ inline-–∫–Ω–æ–ø–æ–∫:

–±–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ backend:

POST /api/favorites —Å —Ç–µ–ª–æ–º { adId } –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å telegramId –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ X-Telegram-Id –∏–ª–∏ –≤ body),

DELETE /api/favorites/:adId –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –±–æ—Ç –¥–æ–ª–∂–µ–Ω:

–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

‚Äú‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ‚Äù,

‚Äú‚úÖ –£–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ‚Äù.

–†–µ–∞–ª–∏–∑—É–π:

—Ö–µ–Ω–¥–ª–µ—Ä –∫–æ–º–∞–Ω–¥—ã /fav_list:

–¥–µ–ª–∞–µ—Ç GET /api/favorites,

–∫—Ä–∞—Å–∏–≤–æ –≤—ã–≤–æ–¥–∏—Ç –º–∞–∫—Å–∏–º—É–º 10 –æ–±—ä—è–≤–ª–µ–Ω–∏–π: –∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ü–µ–Ω–∞, –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –≤–∏–¥–∞ https://<BASE_URL>/ad/<id>.

–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ inline-callback‚Äô–æ–≤:

callback data —Ñ–æ—Ä–º–∞—Ç–∞: fav_add:<adId> –∏ fav_remove:<adId>.

–ò—Å–ø–æ–ª—å–∑—É–π axios –∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É API_BASE_URL, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å, –∏–ª–∏ —Å–æ–∑–¥–∞–π –µ—ë —Å –¥–µ—Ñ–æ–ª—Ç–æ–º "http://localhost:3000".

–í–ê–ñ–ù–û:

–ü–æ–∫–∞–∂–∏ –ø–æ–ª–Ω—ã–π –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª bot/bot.js —Ü–µ–ª–∏–∫–æ–º.

–ù–µ –ª–æ–º–∞–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (/start, /myid, /categories, /new_test_ad).

–ü–æ–∫–∞–∂–∏, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É –∫ inline-–∫–Ω–æ–ø–∫–∞–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ—Ç–≤–µ—Ç –Ω–∞ /new_test_ad —Å—Ä–∞–∑—É –ø—Ä–∏—Å–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É ‚Äú‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ‚Äù).
```

## 6.7.2 ‚Äî Bot Notifications for Price/Status Changes
```
üîß –ü–†–û–ú–ü–¢ –î–õ–Ø CODEX ‚Äî –≠–¢–ê–ü 6.7.2 (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±–æ—Ç)

–£ –º–µ–Ω—è –µ—Å—Ç—å:

Mongoose-–º–æ–¥–µ–ª–∏ Ad –∏ User,

—Ç–∞–±–ª–∏—Ü–∞/–∫–æ–ª–ª–µ–∫—Ü–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (–ª–∏–±–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å Favorite, –ª–∏–±–æ –ø–æ–ª–µ –≤ User),

Telegram-–±–æ—Ç (Telegraf) –≤ bot/bot.js.

–•–æ—á—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é —Å—Ö–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

–ö–æ–≥–¥–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ Ad –º–µ–Ω—è–µ—Ç:

—Ü–µ–Ω—É (price),

—Å—Ç–∞—Ç—É—Å (status),
–Ω—É–∂–Ω–æ:

–Ω–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ,

–ø–æ—Å—Ç–∞–≤–∏—Ç—å –∏–º ‚Äú–∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ‚Äù.

–°–¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å Notification (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ models/Notification.js):

Notification {
  userTelegramId: number;
  adId: ObjectId;
  type: "price_change" | "status_change";
  payload: any; // { oldPrice, newPrice } –∏–ª–∏ { oldStatus, newStatus }
  isSent: boolean;
  createdAt: Date;
  sentAt?: Date;
}

–í AdSchema.pre("save") —Ä–µ–∞–ª–∏–∑—É–π:

—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ this.price / this.isModified("price"),

—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ this.status / this.isModified("status"),

–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:

–Ω–∞–π—Ç–∏ –≤—Å–µ—Ö, –∫—Ç–æ –¥–æ–±–∞–≤–∏–ª this._id –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ,

—Å–æ–∑–¥–∞—Ç—å Notification –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–°–¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç scripts/sendNotifications.js, –∫–æ—Ç–æ—Ä—ã–π:

–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MongoDB (—á–µ—Ä–µ–∑ dotenv –∏ MONGO_URL),

–Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ Notification —Å isSent = false,

–¥–ª—è –∫–∞–∂–¥–æ–π:

—á–µ—Ä–µ–∑ Telegram-–±–æ—Ç (Telegraf –∏–ª–∏ node-telegram-bot-api) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é userTelegramId:

–¥–ª—è price_change: ‚Äú–¶–µ–Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ¬´{title}¬ª –∏–∑–º–µ–Ω–∏–ª–∞—Å—å: {oldPrice} ‚Üí {newPrice} BYN.‚Äù

–¥–ª—è status_change: ‚Äú–°—Ç–∞—Ç—É—Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è ¬´{title}¬ª –∏–∑–º–µ–Ω–∏–ª—Å—è: {oldStatus} ‚Üí {newStatus}.‚Äù

–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–º–µ—á–∞–µ—Ç isSent = true, —Å—Ç–∞–≤–∏—Ç sentAt = new Date().

–ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å (process.exit(0)).

–î–æ–±–∞–≤—å –≤ package.json script:

"scripts": {
  "send-notifications": "node scripts/sendNotifications.js"
}

–ü–æ–∫–∞–∂–∏:

–Ω–æ–≤—ã–π —Ñ–∞–π–ª models/Notification.js,

–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π models/Ad.js —Å —Ö—É–∫–æ–º pre("save"),

–ø—Ä–∏–º–µ—Ä scripts/sendNotifications.js,

–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π package.json (—Ç–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª scripts).

–í–∞–∂–Ω–æ:

–°–¥–µ–ª–∞–π –∫–æ–¥ –Ω–∞ CommonJS (require/module.exports).

–ù–µ –ª–æ–º–∞–π —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –º–æ–¥–µ–ª–µ–π.

–°–∫—Ä–∏–ø—Ç sendNotifications.js –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º, –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö job-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (cron –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä—É—Ç–∏—Ç—å –ø–æ–∑–∂–µ).
```

## 6.8.1 ‚Äî Ads API Geo Search Extension
```
üîß –ü–†–û–ú–ü–¢ –î–õ–Ø CODEX ‚Äî –≠–¢–ê–ü 6.8.1 (–≥–µ–æ–ø–æ–∏—Å–∫ API)

–£–∂–µ –µ—Å—Ç—å:

–ú–æ–¥–µ–ª—å Ad —Å –ø–æ–ª–µ–º location: { lat, lng } –∏ –æ–±—ã—á–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º.

–ù—É–∂–Ω–æ:

–î–æ–±–∞–≤–∏—Ç—å –≤ Ad –≥–µ–æ-–∏–Ω–¥–µ–∫—Å:

–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ geo —Ç–∏–ø–∞ GeoJSON Point:

geo: {
  type: { type: String, enum: ["Point"], default: "Point" },
  coordinates: [Number] // [lng, lat]
}

—Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å geo —Ç–∏–ø–∞ 2dsphere.

—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å geo —Å location –≤ pre("save")/pre("validate").

–†–∞—Å—à–∏—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ GET /api/ads:

–ø—Ä–∏–Ω–∏–º–∞—Ç—å query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

lat, lng ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,

radiusKm ‚Äî —Ä–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö.

–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã lat, lng –∏ radiusKm:

–≤—ã–ø–æ–ª–Ω—è—Ç—å MongoDB –∑–∞–ø—Ä–æ—Å $geoNear –∏–ª–∏ $nearSphere –ø–æ –ø–æ–ª—é geo,

–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–æ–º radiusKm,

–¥–æ–±–∞–≤–ª—è—Ç—å –≤ –æ—Ç–≤–µ—Ç –ø–æ–ª–µ distanceMeters –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

–í –æ—Ç–≤–µ—Ç–µ /api/ads:

–µ—Å–ª–∏ –±—ã–ª –≥–µ–æ–ø–æ–∏—Å–∫, –≤–∫–ª—é—á–∞—Ç—å distanceMeters (–∏–ª–∏ distanceKm, –æ–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–µ).

–ù–µ –ª–æ–º–∞—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É: –µ—Å–ª–∏ –≥–µ–æ–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã, —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ.

–ü–æ–∫–∞–∂–∏:

–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –º–æ–¥–µ–ª—å Ad (–ø–æ–ª–µ geo, –∏–Ω–¥–µ–∫—Å, hook),

–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç /api/ads (–ª–æ–≥–∏–∫–∞ —Å –≥–µ–æ–ø–æ–∏—Å–∫–æ–º).

–ö–æ–¥ ‚Äî CommonJS.
```

## 6.8.2 ‚Äî Seasonal API Enhancements
```
üîß –ü–†–û–ú–ü–¢ –î–õ–Ø CODEX ‚Äî –≠–¢–ê–ü 6.8.2 (—Å–µ–∑–æ–Ω—ã –≤ API)

–ï—Å—Ç—å –º–æ–¥–µ–ª—å Season c –ø–æ–ª—è–º–∏:

code, name, description, startDate, endDate, isActive.

–ï—Å—Ç—å –º–æ–¥–µ–ª—å Ad —Å –ø–æ–ª–µ–º seasonCode.

–ù—É–∂–Ω–æ:

–í GET /api/ads –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ seasonCode:

–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω, –≤—ã–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å —ç—Ç–∏–º seasonCode,

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –≥–µ–æ–ø–æ–∏—Å–∫–∞.

–°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç:

GET /api/seasons/:code/ads

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è, —É –∫–æ—Ç–æ—Ä—ã—Ö seasonCode = :code,

–¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ –∂–µ query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ –∏ /api/ads:

lat, lng, radiusKm,

categoryId, subcategoryId,

limit, page (–ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å).

–ü—Ä–∏–º–µ—Ä: GET /api/seasons/march8_tulips/ads?lat=...&lng=...&radiusKm=5

–æ—Ç–¥–∞—ë—Ç —Å–ø–∏—Å–æ–∫ —Ç—é–ª—å–ø–∞–Ω-–æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ —Ä–∞–¥–∏—É—Å–µ 5 –∫–º.

–ü–æ–∫–∞–∂–∏:

–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π api/routes/ads.js,

–Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –≤ api/routes/seasons.js –¥–ª—è /api/seasons/:code/ads.

–ö–æ–¥ ‚Äî CommonJS.
```
