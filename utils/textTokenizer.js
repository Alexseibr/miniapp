const STOP_WORDS = new Set([
  'и', 'в', 'на', 'под', 'над', 'из', 'по', 'от', 'до', 'с', 'за', 'что', 'это', 'такой',
  'как', 'или', 'но', 'а', 'к', 'у', 'о', 'же', 'ни', 'не', 'да', 'то', 'ли', 'бы',
  'при', 'для', 'без', 'между', 'через', 'над', 'про', 'обо', 'около', 'ко',
  'мой', 'твой', 'его', 'её', 'их', 'наш', 'ваш', 'свой', 'сам', 'весь', 'каждый',
  'все', 'вся', 'всё', 'тот', 'эта', 'этот', 'эти', 'эту', 'той', 'того',
  'он', 'она', 'оно', 'они', 'мы', 'вы', 'ты', 'я',
  'был', 'была', 'было', 'были', 'быть', 'есть', 'будет', 'будут',
  'очень', 'уже', 'ещё', 'еще', 'только', 'тоже', 'также', 'даже',
  'можно', 'нужно', 'надо', 'нельзя',
  'продам', 'куплю', 'сдам', 'сдаю', 'сдается', 'сдаётся', 'обмен', 'обменяю',
  'продаю', 'отдам', 'отдаю', 'меняю', 'ищу', 'требуется', 'нужен', 'нужна', 'нужны',
  'срочно', 'торг', 'возможен', 'уместен', 'реальному', 'покупателю',
  'хорошее', 'отличное', 'идеальное', 'новое', 'новый', 'новая', 'новые',
  'состояние', 'состоянии', 'качество', 'качества',
  'год', 'года', 'лет', 'месяц', 'месяца', 'месяцев', 'день', 'дня', 'дней',
  'рублей', 'руб', 'byn', 'бел', 'долларов', 'usd', 'евро', 'eur',
  'минск', 'брест', 'гомель', 'гродно', 'витебск', 'могилёв', 'могилев',
  'район', 'районе', 'области', 'область', 'город', 'городе',
  'the', 'and', 'for', 'with', 'from', 'this', 'that', 'are', 'was', 'has', 'have',
]);

export function normalizeText(text) {
  if (!text || typeof text !== 'string') return '';
  
  return text
    .toLowerCase()
    .replace(/ё/g, 'е')
    .replace(/[^a-z0-9а-я\s-]/gi, ' ')
    .replace(/\s+/g, ' ')
    .trim();
}

export function tokenize(normalizedText) {
  if (!normalizedText) return [];
  
  return normalizedText
    .split(/\s+/)
    .filter(word => word.length >= 3 && !STOP_WORDS.has(word));
}

export function normalizeAndTokenize(text) {
  const normalized = normalizeText(text);
  return tokenize(normalized);
}

export function getUniqueTokens(text) {
  const tokens = normalizeAndTokenize(text);
  return Array.from(new Set(tokens));
}
