ПРОМТ ДЛЯ REPLIT: ФИКС ЛЕНТЫ (СКРОЛЛ + ХЕДЕР) + РАЗМЕР КАРТОЧЕК + ПОЛНОЕ ПЕРЕСОЗДАНИЕ ФОТО

Ты — senior full-stack (React + Node.js + MongoDB, Telegram MiniApp).
Нужно аккуратно доработать экран Ленты (FeedScreen), не ломая остальной проект.

1. Статичный верхний хедер KETMAR + колокольчик

Проблема:

При свайпах в Ленте:

верхняя панель с логотипом KETMAR и иконкой звонка иногда пропадает,

при свайпе/скролле вниз MiniApp сворачивается (срабатывает жест Telegram, будто потянули весь WebApp вниз).

Нужно:

Сделать отдельный фиксированный хедер:

компонент с логотипом KETMAR, подписью, иконкой уведомлений,

он должен быть ВСЕГДА виден:

не скроллиться с содержимым Ленты,

не исчезать при сменах карточек.

реализовать через position: fixed / sticky внутри MiniApp-контейнера.

Основной контент Ленты (карточки объявлений) должен скроллиться/свайпаться внутри отдельного контейнера, а не по всему документу:

контейнер, например .feedContainer:

строго ограничен по высоте (viewport minus header / minus bottom nav),

все свайпы/scroll внутри него,

с overflow: hidden или контролируемым,

touch-action: pan-y и т.п., чтобы не дергать внешний скролл Telegram.

Убрать “overscroll” на верхней границе, чтобы НЕ срабатывало закрытие WebApp:

при свайпе вниз по карточке Ленты:

должно просто либо показать предыдущую карточку,

либо, если мы условно в начале, останавливаться,

НО НЕ инициировать жест закрытия MiniApp.

если нужно — использовать внутренний виртуальный скролл/свайпы без реального window.scroll.

Итог: при любых свайпах вверх/вниз по Ленте MiniApp не сворачивается, шапка KETMAR + колокольчик всегда на месте.

2. Размер карточек Ленты: видно часть предыдущей и следующей

Сейчас карточка занимает почти весь экран и выглядит как один экран.

Нужно:

Сделать сами карточки немного меньше по высоте:

чтобы в стандартном экране:

текущая карточка была по центру,

снизу было видно верхнюю часть СЛЕДУЮЩЕЙ карточки (10–15% высоты),

и сверху — нижняя часть ПРЕДЫДУЩЕЙ карточки (тоже немного).

эффект: визуально понятно, что это лента карточек, которые листаются по кругу.

Каждую карточку оформить как отдельный “card”:

скругленные углы,

лёгкая тень или тонкая рамка,

фон немного светлее/темнее общего фона.

Анимация:

при свайпе вверх/вниз:

текущая карточка уезжает и частично остаётся на краю,

следующая заезжает — но так, чтобы обе короткое время были видны,

создаётся эффект “карусели” / списка, а не телепортации.

Важно: не ломать уже внедрённую логику плавной смены карточек, просто подогнать высоту/отступы и позиционирование.

3. Убрать весь «влево/вправо» интерфейс и индикаторы фото

В Ленте:

не должно быть:

подписи 1/3, 2/4 и т.п.,

точек-индикаторов количества фотографий,

подсказок, что можно листать влево/вправо.

То есть:

в Ленте показываем только одно главное фото объявления (главное/первое),

пользователь даже не видит, сколько там всего фото,

все остальные фото доступны только в детальной карточке объявления (которая открывается по нажатию).

Логику нескольких фото внутри карточки объявления НЕ трогаем, только UI Ленты.

4. Лайк в Ленте = Избранное

Убедись, что:

При нажатии на сердечко ❤️ в Ленте:

объявление добавляется в “Избранное” (раздел с избранными объявлениями),

используется тот же backend-endpoint, что и при добавлении в избранное из обычной карточки (что-то типа POST /api/favorites/toggle или /api/ads/:id/favorite).

Поведение:

если объявление не в избранном → лайк → добавили в избранное, сердечко стало активным,

если уже в избранном → повторное нажатие снимает избранное, из раздела избранного оно исчезает.

Ошибки API обрабатываем мягко:

оптимистичный апдейт + откат/тост при ошибке или другой разумный вариант,

главное — после успешного запроса состояние Ленты и раздела “Избранное” синхронизированы.

5. Полное пересоздание фотографий объявлений с уменьшенным весом

Нужно полностью переработать демо-фотографии объявлений, чтобы Лента грузилась быстро:

5.1. Требование к формату для Ленты

Для каждой карточки в Ленте использовать предварительно сжатое превью:

ширина ~ 400–600 px (под мобильный, retina 2x),

формат JPG/WEBP,

адекватное сжатие (ориентир: 50–150 Кб на фото),

без потери резкости для пользователя.

Модель Ad:

добавить/использовать поле previewUrl (или imagesPreview[0]), которое хранит URL маленького фото для Ленты.

5.2. Скрипт для пересборки ВСЕХ существующих фото

Сделать отдельный скрипт/джобу:

Найти все объявления в базе, у которых есть images (оригиналы), и:

либо удалить текущие демо-фото (если они тестовые),

либо по ним сгенерировать новые превью.

Для демо-данных:

можно почистить коллекцию объявлений (или тестовую подборку),

заново засеять их новыми объявлениями:

в каждой группе/категории создать по 2–3 объявления,

у каждого объявления 2–3 оригинальных фото.

при загрузке каждого фото:

сохранять оригинал,

генерировать уменьшенную копию (через sharp или аналог),

писать ссылку на превью в previewUrl.

5.3. Лента использует только превью

В FeedScreen:

для главной картинки брать:

const imageUrl = ad.previewUrl ?? ad.images[0];


img:

ленивая загрузка,

фиксированная высота,

скелетон/заглушка, пока картинка не подтянулась.

6. Проверки после доработок

После реализации обязательно проверить руками:

Хедер KETMAR + звоночек:

всегда виден,

ни при каких свайпах не пропадает,

MiniApp не сворачивается, если листаю объявления вверх/вниз.

Свайп вниз по Ленте:

даже при резком/длинном свайпе приложение не “сложилось”,

закрытие MiniApp возможно только, если специально тянуть за верхнюю системную зону, а не при обычной работе с лентой.

Карточки:

ниже текущей видно начало следующей карточки,

выше — хвост предыдущей,

создаётся эффект “карусели”.

UI фото в Ленте:

нет 1/3, 2/4,

нет точек-индикаторов,

просто одно фото.

Лайк:

добавляет/убирает объявление в разделе “Избранное”.

Скорость:

Лента листается быстро,

превью загружаются моментально,

нет долгих белых экранов вместо фото.

Детальная карточка объявления:

всё ещё показывает все фото, как раньше,

ссылки/контакты/описание не сломаны.

Сделай, пожалуйста, всё максимально аккуратно:
шапка KETMAR всегда статична, Лента — независимый контейнер, свайпы вниз не закрывают MiniApp, карточки меньшего размера с намёком на соседние, а все фото объявлений пересобраны в лёгкие превью для быстрой Ленты.