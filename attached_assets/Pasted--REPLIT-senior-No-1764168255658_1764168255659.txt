ПРОМТ ДЛЯ REPLIT: СКРИПТ ТЕСТОВЫХ ОБЪЯВЛЕНИЙ С ГЕО (ФЕРМЕРСКИЙ РЫНОК + ОВОЩИ/ФРУКТЫ)

Ты — senior Node.js + MongoDB разработчик.
Нужно написать скрипт для наполнения БД тестовыми объявлениями с корректными координатами.

1. Контекст проекта

Backend: Node.js / TypeScript (или JS) + MongoDB.

Модель объявлений (обычно Ad или Listing):

в ней уже должно быть поле с GeoJSON-точкой, что-то вроде:

geo: {
  type: { type: String, enum: ['Point'], default: 'Point' },
  coordinates: [Number] // [lng, lat]
}


плюс обычные поля: title, description, price, currency, categoryId / categoryCode, city, address, images и т.д.

Задача — добавить тестовые объявления для:

Категории «Фермерский рынок»

Категории «Овощи/фрукты»

с реальными координатами вокруг Бреста, чтобы можно было тестировать геопоиск и радиусы.

2. Что именно нужно сделать

Сделай отдельный скрипт, например:

scripts/seed_test_ads_farmer_and_veggies.ts (или .js),

команда в package.json, например:

"scripts": {
  "seed:test-geo-ads": "ts-node scripts/seed_test_ads_farmer_and_veggies.ts"
}


(или адаптируй под текущий стек — node, ts-node, tsx и т.п.).

3. Количество и распределение объявлений

Для каждой из двух категорий:

«Фермерский рынок»

«Овощи/фрукты»

Нужно создать по 15 объявлений:

7 объявлений в городе Брест
(в разных районах, но достаточно разных координат в пределах города).

8 объявлений в окрестностях Бреста
(на расстоянии до 20 км от центра города, условно по окружности).

Итого: 30 объявлений.

4. Координаты и геораспределение

Используй координаты центра Бреста:

lat = 52.097622

lng = 23.734051 
latlong.net

Сделай вспомогательную функцию, которая по центру, расстоянию и азимуту даёт новую точку:

function offsetByDistance(
  centerLat: number,
  centerLng: number,
  distanceKm: number,
  bearingDeg: number
): { lat: number; lng: number } {
  // реализуй через формулы на сфере (Haversine / сферическая тригонометрия)
}

4.1. Объявления внутри города (7 шт. на категорию)

Для 7 объявлений в Бресте:

расстояние от центра: случайное от 0.5 до 4 км,

случайный азимут (0–360°),

все координаты внутри условного радиуса города.

4.2. Объявления вокруг города (8 шт. на категорию)

Для 8 объявлений по окрестностям:

расстояние: от 5 до 20 км от центра,

распределить примерно по кругу (можно взять bearings 0, 45, 90, 135, 180, 225, 270, 315 и слегка рандомизировать).

Все координаты сохранить:

в полях:

geo: { type: 'Point', coordinates: [lng, lat] },

плюс, если в схеме есть location, city, region — заполни разумно:

для городских: city: 'Брест',

для загородных: city: 'Брестский район' или конкретные деревни (можно просто в описании указать «20 км от Бреста, деревня …»).

5. Содержание объявлений
5.1. Для категории «Фермерский рынок»

Сделай 15 штук с разными товарами:

картофель, морковь, свёкла, лук, чеснок,

огурцы, помидоры, капуста,

мёд, яйца деревенские,

зелень (укроп, петрушка),

ягоды (клубника, малина, смородина),

молочка (домашнее молоко, творог — если уместно).

Для каждого объявления:

title пример:

[ТЕСТ] Молодой картофель, урожай 2025

[ТЕСТ] Домашняя малина, 1 кг
и т.д.

description:

2–4 предложения на русском, разные формулировки, указать:

откуда товар (собственный участок, деревня, район),

условия: возможна доставка/самовывоз, время сбора, объёмы.

price:

адекватные, но любые тестовые (BYN или RUB — смотри, что у нас используется),

различающиеся между объявлениями.

currency:

установить правильно согласно текущему проекту.

images:

массив строк с левыми фотоссылками (можно взять placeholder’ы с Unsplash/примерные URL),

1–3 фото на объявление, не повторяй один и тот же URL на все.

5.2. Для категории «Овощи/фрукты»

Аналогично 15 объявлений, но акцент именно на:

овощи: картофель, морковь, капуста, кабачки, тыква, лук, свёкла, перец и т.д.

фрукты и ягоды: яблоки, груши, слива, малина, клубника, черника, смородина, вишня.

Структура полей такая же: title, description, price, currency, images, geo, и т.д.

6. Привязка к категориям

Скрипт должен сам найти нужные категории в БД:

Найди документы категорий по slug’ам или названиям (в зависимости от схемы):

"Фермерский рынок" → farmer_market / farmer и т.п.

"Овощи/фрукты" → vegetables_fruits / fruits_veggies и т.п.

Алгоритм:

Найти категории в коллекции categories:

по code/slug/name (посмотри, что реально есть).

Если категория не найдена — выбросить понятную ошибку, чтобы мы поправили slug.

Каждому объявлению поставить:

categoryId (или categoryCode) этих категорий.

7. Пометка как тестовые данные и идемпотентность

Очень важно, чтобы скрипт можно было гонять повторно.

Сделай так:

В title добавляй префикс [ТЕСТ],

либо используй поле isTestData: true (если в модели есть или можешь добавить).

Скрипт перед вставкой должен:

Найти и удалить/очистить все старые тестовые объявления для этих категорий:

await Ad.deleteMany({
  isTestData: true
  // или title: /^\\[ТЕСТ]/, и categoryId in [id_фермерский, id_овощи]
});


После этого вставить новые 30 объявлений через insertMany.

8. Структура и подключение к БД

Внутри scripts/seed_test_ads_farmer_and_veggies:

Подключиться к MongoDB, используя уже готовую функцию подключения из проекта (например, connectDB()).

Импортировать модель Ad и модель Category.

В main():

подключиться к БД,

найти категории,

сгенерировать массив объявлений (30 шт),

удалить старые тестовые,

вставить новые,

вывести в консоль сводку:

Создано 15 тестовых объявлений для "Фермерский рынок"

Создано 15 тестовых объявлений для "Овощи/фрукты"

закрыть соединение с БД.

9. Проверка

После запуска npm run seed:test-geo-ads:

В БД должны появиться 30 объявлений с:

разными товарами и описаниями,

не одинаковыми ценами,

валидными URL картинок (пусть и тестовыми),

заполненным полем geo (Point, [lng, lat]),

пометкой [ТЕСТ] или isTestData: true.

В интерфейсе:

на карте и в блоках “Рядом с вами” / категориях будет видно разнорасположенные точки:

часть в городе Брест,

часть вокруг города до 20 км.