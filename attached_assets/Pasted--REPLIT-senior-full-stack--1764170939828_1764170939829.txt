ПРОМТ ДЛЯ REPLIT: ПОЧИНИТЬ СОЗДАНИЕ ОБЪЯВЛЕНИЯ + КОНТАКТЫ ПРОДАВЦА

Ты — senior full-stack разработчик.
Прошу аккуратно доработать существующий функционал создания объявления в MiniApp/веб-приложении маркетплейса (KETMAR). Сейчас многие вещи уже работают, поэтому:

ВАЖНО: не переписывай всё с нуля, не ломай существующую логику и стили. Точечно чини и дописывай.

1. Проблема: создание объявления “зависает”

Сейчас при нажатии на плюс “Создать объявление”:

я захожу в мастер создания объявления,

на этапе определения местоположения или первом шаге всё зависает и нельзя пройти до конца.

Задача №1:
Полностью проверить и починить весь поток создания объявления:

Нажатие на "+" / "Добавить объявление".

Все шаги мастера.

Отправка на backend.

Успешная публикация + корректное отображение карточки товара.

Если какие-то шаги уже реализованы — используй их, не выкидывай рабочий код.

2. Поток создания объявления: шаги мастера

Нужно привести мастер создания объявления к следующей логике (если часть уже есть — приведи к этому стандарту):

Шаг 1. Категория / основные данные (если уже реализовано — оставить)

Выбор категории/группы товаров.

При переходе дальше — данные должны сохраняться в локальном состоянии мастера.

Шаг 2. Фотографии товара

Требования:

Допускается 0–4 фотографий:

0 фото — пользователь может пропустить шаг (будет объявление без фото, для тестов это важно).

1 фото — стандартный кейс.

2–4 фото — все должны корректно загружаться и сохраняться.

Нужно:

проверить/исправить компонент загрузки изображений,

убедиться, что:

файлы реально отправляются на backend (или в файловое хранилище),

ссылки на них сохраняются в поле images / photos объявления,

UI адекватно показывает предпросмотр и возможность удалить/заменить фото до отправки.

Шаг 3. Название, описание, цена

Поля:

Название товара (обязательное поле).

Описание (желательно, но можно не обязательное при наличии кнопки “Помочь с описанием”).

Цена:

число,

валюта — белорусские рубли (BYN) — либо зафиксировать в форме, либо выбрать BYN по умолчанию.

Помощь в описании:

Нужна кнопка/ссылка типа: Помочь с описанием или Сгенерировать описание.

Логика:

если пользователь ввёл, например, “ягода”, “малина”, “клубника”, “картошка” и т.п.:

по нажатию на кнопку вызывается существующий/новый backend-endpoint с AI (если у нас уже есть ассистент),

backend генерирует текст описания (на русском) и возвращает,

текст подставляется в поле “Описание” (с возможностью отредактировать вручную).

если AI-endpoint ещё нет — создай простой заглушечный endpoint и пометь TODO, но UI должен быть готов к работе с ним.

Важно: поля должны валидироваться до отправки, с понятными сообщениями об ошибках.

3. Контакты продавца: телефон и Telegram username

Нужно реализовать систему контактов продавца при создании объявления и в карточке товара.

3.1. На шаге создания объявления

Поля:

Номер телефона:

по умолчанию, если у пользователя в профиле уже сохранён телефон — подтянуть его автоматически в форму,

дать возможность:

изменить номер,

или убрать (если не хочет показывать телефон).

валидация: формат белорусского номера (или международный, если у нас так принято).

Telegram username:

попытаться подтянуть автоматически из Telegram (если у нас есть доступ / уже храним это в профиле),

дать возможность отредактировать/ввести.

Галочки выбора контактов:

пользователь должен видеть чекбоксы/переключатели:

[ ] Показать номер телефона

[ ] Показать Telegram

возможные варианты:

только телефон,

только Telegram username,

оба сразу.

эти настройки должны сохраняться в объявлении.

Модель объявления (backend):

Добавь/убедиcь в наличии полей:

contactPhone: string | null

contactTelegramUsername: string | null

contactShowPhone: boolean

contactShowTelegram: boolean

(названия можешь адаптировать под текущую модель, но смысл такой.)

4. Отображение контактов в карточке товара (frontend)

Сейчас в карточке товара:

уже есть блок “Продавец”,

указано:

имя продавца / ник,

с какого года/месяца он на платформе.

Это нужно оставить.

Нужно добавить блок контакта, но не светить сразу телефон / username в открытую:

4.1. Общие требования

Контакты должны быть “заблюрены” / скрыты до клика, чтобы:

пользователь нажимал кнопку/иконку “Показать контакты” / “Связаться”,

после этого контакты становились видны.

При этом мы должны отслеживать количество таких раскрытий (см. пункт про аналитику).

4.2. Вариант 1: есть только телефон

Если в объявлении:

contactShowPhone = true и contactPhone задан,

contactShowTelegram = false или contactTelegramUsername = null.

Тогда:

В карточке показываем кнопку, например:

Показать номер или иконку телефона.

До клика:

номер скрыт (+375 ** *** ** **), либо вообще не показан.

После клика:

раскладываем UI:

показываем сам номер,

и даём варианты:

Позвонить → открытие dialer на телефоне (tel:),

Написать в Telegram → если Telegram установлено и есть возможность, открываем tg:// с этим номером / контактом (на твой выбор, но UI подготовь).

4.3. Вариант 2: есть только Telegram username

Если:

contactShowTelegram = true и contactTelegramUsername задан,

телефона нет или скрыт.

Тогда:

В карточке показываем крупную иконку Telegram или кнопку Написать в Telegram.

До клика:

username не обязательно писать полностью, можно “заблюрить” или показать иконку + “Связаться”.

При клике:

открываем чат с продавцом:

через https://t.me/<username> или tg://resolve?domain=<username> — в зависимости от того, как принято в текущем проекте и окружении (в MiniApp лучше использовать стандартные методы открытия ссылок в Telegram).

пользователь переходит в диалог и может общаться.

4.4. Вариант 3: и телефон, и Telegram

Если:

contactShowPhone = true,

contactShowTelegram = true.

Тогда:

Кнопка Показать контакты (или иконка).

После клика:

показываем:

номер + кнопка Позвонить,

и рядом/ниже — иконка Telegram / Написать в Telegram.

До клика — контакты скрыты (номера и username не видны или замазаны).

5. Аналитика: сколько раз раскрывали контакты

Нужно сделать так, чтобы мы могли считать, сколько людей нажали “показать контакты” у объявления.

5.1. Backend поле в объявлении

В модели Ad:

добавь поля (или используй уже существующее что-то похожее):

contactRevealCount: number (по умолчанию 0)

5.2. Endpoint для инкремента

Сделай endpoint:

POST /api/ads/:id/contact-reveal

Авторизация — стандартная (как на других защищённых эндпоинтах).

Логика:

найти объявление по :id,

увеличить contactRevealCount на 1,

опционально — записать отдельное событие в аналитическую коллекцию типа user_contact_events с userId, adId, timestamp.

Вернуть:

{ success: true, contactRevealCount: newValue }.

5.3. Frontend

В карточке товара:

При первом клике на “Показать контакты” / “Связаться”:

вызвать POST /api/ads/:id/contact-reveal,

по успешному ответу раскрыть блок с контактами.

Повторные клики по уже раскрытым контактам могут не вызывать повторного инкремента (достаточно один раз на пользователя/сессию) — но это на твоё усмотрение, главное — не спамить запросами.

Ошибки при инкременте не должны ломать UI:
если не получилось отправить лог — всё равно показываем контакты пользователю.

6. Тест-кейсы, которые нужно вручную проверить

После изменений обязательно проверь руками (и, по возможности, добавь unit/интеграционные тесты):

Создание объявления с 0 фото:

пройти все шаги,

опубликовать,

убедиться, что объявление успешно создаётся и показывается в ленте/категории.

Создание объявления с 1 фото.

Создание объявления с 4 фото.

Варианты контактов:

только телефон,

только Telegram username,

оба сразу,

и ни одного (если такое допустимо — тогда в карточке не показываем блок контактов).

Открытие карточки объявления:

блок “Продавец” отображается как и раньше,

дополнительно корректно работает:

кнопка “Показать контакты”,

раскрываться телефон и/или Telegram,

нажатие на телефон → звонок/предложение вызвать dialer,

нажатие на Telegram → переход в чат.

Проверить, что при раскрытии контактов:

счётчик contactRevealCount увеличивается,

UI не ломается при ошибке backend.

Убедиться, что:

поток создания объявления больше не зависает,

все шаги мастера проходят без ошибок,

внешне дизайн/верстка не “слетели” на других экранах.

Ещё раз:
пожалуйста, не ломай рабочие части приложения, не меняй архитектуру и стили радикально.
Максимально точечные правки вокруг:

мастера создания объявления,

сохранения фото/описания/цены,

контактов продавца,

и отображения этих контактов в карточке.