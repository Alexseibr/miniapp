Хочу, чтобы ты сделал ПОЛНОЕ ТЕХНИЧЕСКОЕ РЕВЬЮ проекта Ketmar Market и аккуратные правки в ОТДЕЛЬНОЙ ГИТ-ВЕТКЕ.

ТЕХНОЛОГИИ (ориентировочно):
- backend: Node.js / TypeScript или JavaScript, Express / Nest / Telegraf
- frontend: React / Vite / MiniApp (Telegram WebApp)
- база: MongoDB
- есть бот, MiniApp, web, возможно docker-compose и Dockerfile’ы
- репозиторий связан с GitHub

ОБЩИЕ ТРЕБОВАНИЯ:
1. НИЧЕГО НЕ ЛОМАТЬ, что сейчас работает:
   - не менять публичные API-контракты без крайней необходимости
   - не удалять рабочий код, если не уверен на 100%
   - все изменения делать в новой ветке Git, не в main/master
2. СФОКУСИРОВАТЬСЯ на:
   - реальных ошибках (runtime, import, типы, undefined и т.п.)
   - дублирующихся запросах к API / базе / CDN
   - лишних и мертвых ссылках/эндпоинтах
   - потенциальных утечках памяти / бесконечных лупах
   - производительности (особенно для ленты объявлений и фото)
3. В КОНЦЕ:
   - всё закоммитить в ОТДЕЛЬНУЮ ВЕТКУ (например, `prot-code-review`)
   - подготовить короткий SUMMARY/CHANGELOG по изменениям в markdown файле

ПОДРОБНО ЧТО НУЖНО СДЕЛАТЬ:

=============================
1. GIT: СОЗДАТЬ ОТДЕЛЬНУЮ ВЕТКУ
=============================
- Определи текущую основную ветку (main/master).
- Создай новую ветку на её основе, например:
  git checkout -b prot-code-review
- Все дальнейшие изменения — ТОЛЬКО в этой ветке.

Если в Replit есть встроенная Git-панель — используй её, но с тем же смыслом:
- создать новую ветку от основной
- работать только в ней.

===================================
2. БЫСТРАЯ ПРОВЕРКА СБОРКИ / ТЕСТОВ
===================================
- Найди скрипты в package.json:
  - "start", "dev", "build", "test", "lint", если есть.
- Запусти:
  - npm run lint        (если существует)
  - npm test            (если есть тесты)
  - npm run build       (для фронта и/или бэка)
- Все реально воспроизводимые ошибки/варнинги:
  - зафиксируй и исправь по месту, если правка очевидна и безопасна
  - не меняй бизнес-логику без необходимости

========================================
3. БЭКЕНД: АУДИТ КОДА И ДУБЛЕЙ ЗАПРОСОВ
========================================
Проверить:
- /src или /backend директории:
  - контроллеры / routes
  - services
  - middleware
  - модели (Mongoose/Prisma и т.п.)

ЗАДАЧИ:
3.1. Ошибки и потенциальные падения:
- Найди места, где:
  - нет try/catch вокруг внешних запросов (к БД, внешним API, файловой системе)
  - нет проверки на null/undefined перед доступом к полям
  - возможен доступ к req.body/params без валидации
- Добавь аккуратную валидацию и проверку, но БЕЗ переписывания логики.

3.2. Дублирующиеся запросы:
- Найди, где один и тот же роут/handler:
  - дважды дергает БД с одинаковыми параметрами
  - дважды ходит в один и тот же внешний сервис
- Если есть дубли — вынеси повторяющуюся логику в функцию или сервис.
- Убедись, что:
  - общее поведение не меняется,
  - сокращается количество одинаковых запросов.

3.3. Лишние/мёртвые эндпоинты:
- Найди роуты, которые не используются нигде во frontend/bot/MiniApp:
  - если уверен, что они мёртвые — либо явно пометь комментарием `// TODO: legacy endpoint, candidate for removal`
  - либо вынеси в отдельный legacy-файл, НО НЕ УДАЛЯЙ полностью без необходимости.

3.4. Логи и ошибки:
- Убедись, что:
  - нет console.log с чувствительными данными (token, password, phone и т.п.)
  - в случае ошибок возвращаются осмысленные статусы (4xx/5xx) и JSON-ответы
- Если логика обработки ошибок разбросана — сведи её к единому error middleware, если это легко сделать и уже есть структура под это.

=======================================
4. ФРОНТЕНД / MINIAPP: ЗАПРОСЫ И ЛИНКИ
=======================================
Проверить:
- компоненты ленты объявлений
- карточки товара/объявления
- запросы на загрузку фото, списка объявлений, фильтрацию и т.п.
- маршруты/роутинг (React Router)

ЗАДАЧИ:
4.1. Дублирование запросов:
- Найди компоненты, где один и тот же API эндпоинт:
  - вызывается в нескольких useEffect с одинаковыми зависимостями,
  - вызывается и в родителе, и в дочернем компоненте без необходимости.
- Сократи до одного запроса, передавая данные вниз по пропсам.

4.2. useEffect и зависимости:
- Проверь useEffect:
  - можешь ли поправить зависимости так, чтобы:
    - не было бесконечных перерендеров
    - запросы не шли в бесконечном цикле.
- Исправь только явно ошибочные зависимости.

4.3. Ссылки и маршруты:
- Найди "мертвые" ссылки:
  - ссылки на маршруты, которых не существует
  - переходы на старые/неиспользуемые пути
- По возможности:
  - исправь на актуальные маршруты
  - или добавь redirect / fallback (страницу 404) без изменения существующей навигации.

4.4. Отображение фотографий:
- Убедись, что:
  - используются корректные поля из API (например, previewImage / images[0].url / и т.п.)
  - есть fallback, если картинка не загрузилась (placeholder или другая версия)
- Если уже писал fallback ранее — проверь, что он реально работает, и поправь, если нет.

=============================================
5. БОТ / TELEGRAM MINIAPP: СТАБИЛЬНОСТЬ КОДА
=============================================
Если в проекте есть бот (Telegraf / node-telegram-bot-api и т.п.):

- Проверь:
  - обработчики update/message/callback_query
  - web_app_data / deep-link параметры
- Убедись, что:
  - нет необработанных исключений при сетевых ошибках Telegram
  - нет долгих синхронных операций, блокирующих event loop
- Добавь:
  - try/catch вокруг критических мест
  - логирование ошибок в одном месте (например, middleware для ошибок бота)
- НЕ МЕНЯЙ поведение команд и меню, только укрепи стабильность.

=================================
6. КОНФИГ, ENV, DOCKER, INFRA
=================================
- Проверь:
  - .env.example или README по переменным окружения
  - Dockerfile, docker-compose.yml (если есть)
- Задачи:
  - убедись, что в репо не лежат реальные секреты
  - проверь, что порты, имена сервисов и переменные окружения согласованы между backend, frontend, bot, db
  - если замечены очевидные ошибки (лишний EXPOSE, неиспользуемые build-аргументы, тяжелые слои) — поправь, но без полной переделки.

==========================
7. ЧИСТКА КОДА И СТИЛЬ
==========================
- Удали:
  - неиспользуемые импорты
  - мертвые переменные
  - старые закомментированные куски кода, которые явно уже не нужны (TODO: если они действительно не несут смысловой нагрузки).
- Приведи код в единый стиль:
  - через существующий eslint/prettier конфиг, если он есть.
- Не вводи новый стилевой стандарт, если уже используется какой-то конкретный.

===========================================
8. ДОКУМЕНТАЦИЯ И ИТОГОВЫЙ ОТЧЕТ (SUMMARY)
===========================================
- В корне репозитория создай файл:
  - TECH_REVIEW_PROT.md (или аналогичное имя)
- В этом файле кратко опиши:
  - какие области были просмотрены (backend, frontend, bot, infra)
  - какие проблемы найдены
  - какие исправлены
  - что помечено как TODO / legacy
- Список изменений:
  - пункты вида:
    - [backend] убраны дублирующиеся запросы к БД в маршруте ...
    - [frontend] исправлен двойной запрос к /api/ads/...
    - [bot] добавлен try/catch и логирование ошибок ...
    - [infra] очищен Dockerfile от лишних слоёв ...

=====================
9. GIT: КОММИТ И PUSH
=====================
- Все изменения в файлах аккуратно проиндексируй:
  git status
  git add .
- Сделай осмысленный коммит:
  git commit -m "tech: full code review (prot branch)"
- Запушь ветку на GitHub:
  git push origin prot-code-review

Если какие-то команды уже выполняет Replit автоматически — убедись, что конечный результат:
- новая ветка есть на GitHub
- все изменения в ней
- основная ветка не затронута.

НАПОМИНАНИЕ:
Главный приоритет — стабильность: исправить явные ошибки, дубли и мусор, улучшить качество кода и его читаемость, НО НЕ ЛОМАТЬ текущий рабочий функционал и не менять бизнес-логику.
