РОМТ ДЛЯ REPLIT: ФИКС КАРУСЕЛИ ЛЕНТЫ + ПЕРЕСБОРКА ФОТО (v1.3.1)

Ты — senior full-stack dev (React + Node.js + MongoDB, Telegram MiniApp).
Нужно ДОПИЛИТЬ уже работающую Ленту (FeedScreen), ничего не ломая, но:

починить верхнюю панель KETMAR,

убрать визуальные индикаторы количества фото,

улучшить визуал карточек (рамка + чуть видна следующая/предыдущая),

сделать лайк = добавление в избранное,

пересобрать все фото под быстрые превью и подключить их в Ленте.

Ниже по пунктам.

1. ФИКС ВЕРХНЕЙ ПАНЕЛИ (KETMAR + ЗВОНОК)

Проблема:

При свайпах по Ленте верхняя панель с логотипом KETMAR и иконкой колокольчика:

иногда пропадает,

при сильном свайпе вниз может срабатывать системный жест Telegram и мини-ап сворачивается.

Нужно:

Сделать так, чтобы верхняя панель всегда была фиксирована:

отдельный <header>/div с position: sticky или fixed внутри MiniApp,

она НЕ должна уходить/скроллиться вместе с контентом Ленты.

Основной скролл/свайпы Ленты должны происходить внутри собственного контейнера, а не по document/body, чтобы:

при свайпе вниз/вверх НЕ срабатывало закрытие WebApp в Telegram.

Если нужно — отключи/смягчи "overscroll" на верхней/нижней границе:

использовать внутренний контейнер типа:

.feed-scroll {
  overflow: hidden;
  touch-action: pan-y;
}


и обрабатывать свайпы внутри (как сейчас), но так, чтобы Telegram-жест закрытия не срабатывал.

Результат:

При любом количестве свайпов вверх/вниз:

панель KETMAR + колокольчик всегда на месте,

MiniApp не закрывается от “перетянул вниз”.

2. УБРАТЬ ВИЗУАЛЬНЫЕ ИНДИКАТОРЫ КОЛИЧЕСТВА ФОТО

Сейчас:

На карточке Ленты:

сверху/в углу показывается “1/3”, “2/4” и т.п. — сколько фото,

снизу/на фото есть точечки (pager) по количеству изображений.

Нужно:

Полностью убрать из Ленты:

оверлей с 1/3, 2/3 и т.п.,

индикатор-точки под фото.

При этом:

логика с несколькими фото в детальной карточке объявления (при открытии) остаётся, как была.

в Ленте пользователь не видит, сколько там фото — просто одну главную картинку.

3. ВИЗУАЛ КАРТОЧКИ: РАМКА + ПИК СЛЕДУЮЩЕЙ/ПРЕДЫДУЩЕЙ

Нужно немного доработать визуал, чтобы было понятно, что можно свайпать:

Рамка/карточка:

каждая карточка объявления (название + фото + район + цена) должна быть в аккуратной “плитке”:

скруглённые углы,

лёгкая тень / border,

фон чуть отличающийся от общего белого фона.

Видна часть следующего объявления снизу:

при показе текущей карточки:

снизу должна быть чуть-чуть видна верхняя часть следующей карточки (несколько пикселей/10–15% высоты заголовка), чтобы визуально было понятно: “там есть ещё”.

Чуть видна ушедшая карточка сверху:

при свайпе вверх:

карточка, которая уходит, не должна исчезать мгновенно,

можно оставить её часть “вверх ушедшей” (анимация), чтобы почувствовалось движение списка.

это можно сделать через:

контейнер с overflow: visible,

анимацию translateY/opacity,

при смене индекса показывать одновременно предыдущую + текущую карточку, как сейчас, но с таким offset, чтобы края были видны.

Главное: пользователь визуально понимает, что Лента — список карточек, а не один экран.

4. ЛАЙК = ДОБАВИТЬ В ИЗБРАННОЕ

Сейчас:

при нажатии на ❤️ в Ленте:

визуально что-то может меняться, но в раздел “Избранное” объявление не попадает.

Нужно:

Привязать лайк Ленты к уже существующей логике избранного (если есть):

найти backend-endpoint который используется на вкладке “Избранное”/сердечко в карточке объявления (что-то вроде POST /api/favorites/toggle или /api/ads/:id/favorite),

использовать его же при нажатии на лайк в Ленте.

Поведение:

первое нажатие:

объявление помечается как избранное (isFavorite = true),

вызывается API,

таб “Избранное” после этого содержит это объявление.

повторное нажатие:

снимает избранное (isFavorite = false),

объявление исчезает из списка избранного.

UI:

активное избранное — заполненное/цветное ❤️,

неактивное — контур.

Важно:

обработать ошибки API (например, если сеть отвалилась) аккуратно:

оптимистичный апдейт + откат при ошибке, либо

сохранять локально, а синк делать фоном.

5. ПЕРЕСБОРКА ФОТО ДЛЯ ЛЕНТЫ (БЫСТРЫЕ ПРЕВЬЮ)

Нужно, чтобы все объявления в Ленте использовали отдельные лёгкие превью-картинки, а не тяжёлые оригиналы.

5.1. Формат превью

Сделай на бэке:

поле в модели Ad, например:

previewUrl или imagesPreview[] (минимум для первого фото).

Превью:

размер ~ 400–600 px по ширине (под мобильный, 2x retina),

сжатие JPG/WEBP,

максимальный вес как можно меньше (ориентир 50–150 Кб).

5.2. Скрипт/джоб на пересборку ВСЕХ старых фото

Нужно:

Написать скрипт/CLI/one-off job:

пройти по всем Ad, где есть images[0] и ещё нет previewUrl,

для первого фото:

скачать/взять оригинал,

через sharp (или другую lib) сделать уменьшенную копию,

загрузить в то же хранилище (S3/облако/локально),

записать ссылку в previewUrl.

Запустить джоб один раз (или по частям), чтобы все текущие объявления получили previewUrl.

На будущее:

при загрузке новых фото в мастере подачи объявления:

сразу генерить превью и писать previewUrl.

5.3. Использовать превью в Ленте

В FeedScreen:

для картинок брать:

сначала previewUrl если есть,

если нет — fallback на images[0].

В <img>:

ленивая загрузка,

skeleton/placeholder пока грузится.

Идея: после джоба Лента должна листаться почти мгновенно, как TikTok.

6. ПРОВЕРКА ПОСЛЕ ПРАВОК

После всех изменений проверь:

Верхняя шапка KETMAR + колокольчик:

всегда на месте, не исчезает,

при активном листании вниз MiniApp не закрывается.

В карточках:

нет обозначений 1/3, 2/4,

нет точек-индикаторов количества фото.

Карточка:

в рамке/плитке,

немного видна следующая снизу,

при свайпе часть ушедшей сверху/снизу ещё чуть видна (ощущение списка).

Лайк:

при нажатии:

сердечко меняет состояние,

объявление появляется/исчезает во вкладке “Избранное”.

Скорость:

Лента быстро листается,

превью подгружаются моментально (особенно после прогрева),

на медленном интернете нет белых экранов вместо фото.

Детальная карточка объявления:

продолжает показывать все фото, как раньше,

логика контактов/описаний/цены не сломана.

Сделай, пожалуйста, все правки максимально аккуратно:
не ломай остальную архитектуру Ленты и MiniApp, только доработай карусель и работу с фото по описанным пунктам.