ПРОМТ ДЛЯ REPLIT: ПОЧИНИТЬ ЗАСТРЕВАЮЩИЙ ШАГ ЛОКАЦИИ ПРИ ПОДАЧЕ ОБЪЯВЛЕНИЯ

Ты — senior full-stack разработчик (React + Node.js + Telegram MiniApp).
Нужно очень аккуратно починить мастер подачи объявления, не ломая остальной функционал.

0. Контекст

Сценарий, который сейчас ломается:

Я нажимаю во вкладке «Мои» (нижнее меню) кнопку «Добавить объявление».

Открывается мастер «Подача объявления».

На первом шаге вижу экран, как на скриншоте:

заголовок: “Где вы продаёте?”

подсказка: “Укажите город и район для вашего объявления”

большая синяя карточка с текстом:

“Ваше местоположение:”

Брест (Заречный) (подтянуто автоматически)

ниже кнопка “Выбрать другое место”.

На этом шаге мастер зависает:

я не могу перейти к следующему шагу (фото/описание и т.д.),

нет явной кнопки “Далее” или, если она есть, она не работает.

При этом часть логики мастера уже работает (дальнейшие шаги ранее были реализованы), поэтому:

❗ ВАЖНО: ничего радикально не переписывать, только починить переход со шага локации на следующий шаг и проверить весь поток.

1. Воспроизведи и сравни два сценария

Запусти MiniApp локально.

Проверь оба варианта входа в мастер (если второй уже реализован):

из вкладки «Мои» → “Добавить объявление” (ломается),

если есть другой вход (например, через плюс на главной) — сравни, работает ли там переход.

Задача — понять:

различается ли начальное состояние мастера,

не теряются ли параметры маршрута,

не отличается ли контекст (например, нет ли category или еще чего-то, из-за чего шаг "локация" не даёт перейти дальше).

2. Найди и проверь компонент шага локации

Найди React-компонент, который рендерит экран:

“Подача объявления” + прогресс бар по шагам,

заголовок “Где вы продаёте?”,

большую карточку Ваше местоположение: Брест (Заречный),

кнопку “Выбрать другое место”.

Названия компонентов могут быть типа:

CreateAdWizard, AdCreationFlow, AdLocationStep, LocationStep, WhereYouSellStep и т.п.

Нужно:

Найти контейнер мастера:

где хранится currentStep,

где вызывается goToNextStep() / setStep(step + 1) и т.п.

Найти обработчики для шага локации:

обработчик клика по большой синей карточке (подтверждение текущей гео),

обработчик для “Выбрать другое место”,

условие, при котором появляется/активируется кнопка “Далее” (если она есть).

3. Разобраться, почему не срабатывает переход на следующий шаг

Скорее всего, проблема в одном из вариантов:

Состояние локации не считается “выбранным”

Мастер ждёт, что будет заполнен, например, selectedCity и selectedDistrict / geo,

но при автоматическом определении “Брест (Заречный)” эти поля не проставляются, и валидатор не даёт перейти дальше.

Нет/не привязана кнопка “Далее”

Возможно, переход на следующий шаг должен происходить по клику на:

саму синюю карточку,

или спрятанную кнопку “Далее”,

но onClick не вызывает goToNextStep().

Разные входные параметры между входом через «Главная» и через «Мои»:

через один маршрут в стор кладётся draftAd с нужными полями,

через другой — нет, и мастер “ломается” на проверке.

Что сделать:

Временно добавь console.log или явный вывод в UI:

текущее step,

состояние location / city / district / geo,

состояние isLocationValid.

Посмотри, вызывается ли обработчик “подтвердить местоположение”.

4. Исправление поведения шага “Где вы продаёте?”

Нужно добиться следующей логики:

Если местоположение уже определено (например, Брест (Заречный)):

пользователю достаточно нажать на синюю карточку (или кнопку “Далее”, если есть),

после этого:

сохраняем город и район в draft объявления (draftAd.location.city, district, geo),

переводим мастер на следующий шаг (фото).

Если пользователь нажимает “Выбрать другое место”:

открывается экран/модалка выбора города/района,

после выбора:

обновляем draftAd.location,

возвращаемся на шаг “Где вы продаёте?” уже с новым текстом,

по нажатию на подтверждение или сразу автоматом → шаг фото.

Сделай так, чтобы:

по нажатию на синюю карточку (или явно видимую кнопку “Далее”) всегда выполнялось:

if (locationIsValid) {
  saveLocationToDraft();
  goToNextStep();
} else {
  showValidationError();
}


Где locationIsValid = есть город, район и/или координаты.

5. Проверка валидации

Проверь, нет ли “невидимых” ошибок валидации, которые блокируют переход:

Найди функцию/схему, которая валидирует draft объявления по шагам:

возможно, там стоит жёсткое условие, что на шаге 1 уже должны быть заполнены ещё какие-то поля (например, категория, тип товара).

Исправь порядок:

на шаге “Где вы продаёте?” проверяем только локацию,

остальные поля валидируем на следующих шагах.

Если нужно — сделай по шагам validateStep(step, draftAd).

6. Регресс-тест: пройти весь мастер от начала до публикации

После фикса:

Сценарий 1 — авто-местоположение:

Вкладка “Мои” → “Добавить объявление”.

На шаге “Где вы продаёте?”:

видим местоположение Брест (Заречный),

нажимаем по синей карточке (или “Далее”),

мастер должен перейти к шагу загрузки фото.

Сценарий 2 — выбрать другое место:

Нажать “Выбрать другое место”,

выбрать город/район вручную,

подтвердить выбор,

перейти к следующему шагу.

Дальше:

загрузить 0 фото → протестировать (если такое допускается),

загрузить 1–4 фото,

заполнить название, описание, цену,

задать контакты,

опубликовать объявление.

Убедиться, что:

объявление появляется в “Мои объявления”,

и/или на карте / в категориях, в соответствии с указанной локацией.

7. Осторожность

Не меняй глобальную архитектуру мастера (CreateAdWizard) и роутинг, только чинь текущую логику шага “Где вы продаёте?”.

Не удаляй другие шаги и их валидацию.

Не ломай навигацию снизу (табы “Главная / Лента / Мои / Избранное / Профиль”).

Сделай, пожалуйста, всё максимально аккуратно:
главная цель — чтобы после выбора “Брест (Заречный)” (или другого места) мастер обязательно переходил к следующему шагу подачи объявления при входе через вкладку «Мои → Добавить объявление».