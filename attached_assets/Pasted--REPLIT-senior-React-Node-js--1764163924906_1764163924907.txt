ПРОМТ ДЛЯ REPLIT: ЭКРАН КАТЕГОРИИ + РАДИУС, ФИЛЬТРЫ, СОРТИРОВКА

Ты — senior React / Node.js разработчик.
Нужно допилить логику и UI экранов категорий в Telegram MiniApp KETMAR.

1. Контекст

У нас есть главная страница с быстрыми категориями:

Фермерский рынок

Овощи/фрукты

Выпечка свежая

Личные вещи

Одежда

Обувь

Бытовые мелочи

Телефоны & Электроника

Сельхоз техника

Услуги

Аренда инструмента

Даром отдаю
…и т.д.

Сейчас при клике по категории может открываться список подгрупп (подкатегорий).
Так больше не должно быть.

2. Новое поведение при клике по категории

Когда пользователь нажимает на любую основную категорию с главной (например, “Фермерский рынок”):

Открывается экран списка объявлений этой категории (без промежуточного экрана с подгруппами).

Объявления сразу показываются, отфильтрованные:

по выбранной категории,

по радиусу от пользователя (см. ниже).

Подгруппы/подкатегории доступны только через Фильтры, а не отдельным экраном.

Сделай общий компонент/экран, который можно использовать для любой категории:

маршрут типа: /category/:categoryCode или аналогичный,

заголовок берётся из категории (Фермерский рынок, Овощи/фрукты, Выпечка и т.п.).

3. Верхняя панель экрана категории

Как на приложенном скрине:

Сверху статусбар телефона (это даст сам Telegram, здесь ничего не трогаем).

Ниже:

Слева иконка стрелка назад → возвращает на предыдущий экран (обычно главная).

Посередине — название категории, например: Фермерский рынок.

Справа пока ничего (можно оставить пусто).

Под заголовком — горизонтальный список кнопок-радиусов:

300м 1км 3км 5км 10км 20км

Это toggle-переключатели, только один активен.

Активная кнопка подсвечена (как на скрине: голубой фон, белый текст), остальные — просто текст.

По умолчанию при входе в категорию:

радиус = 3км (можно вынести в константу DEFAULT_RADIUS_KM = 3).

4. Логика загрузки объявлений по радиусу

Нужно связать UI радиусов с backend.

4.1. API

Используй/добавь endpoint (можно адаптировать под текущий проект):

GET /api/ads/nearby?categoryId=...&lat=...&lng=...&radiusKm=...&sort=...&subcategoryId=...

Параметры:

categoryId или categoryCode — основная категория (фермерский рынок, одежда и т.д.).

lat, lng — координаты пользователя (берём из ранее определенного geo или запрашиваем).

radiusKm — одно из значений: 0.3, 1, 3, 5, 10, 20.

sort — режим сортировки (см. ниже).

subcategoryId (опционально) — если выбран фильтр по подгруппе (морковь, картофель и т.п.).

Backend должен возвращать:

список объявлений с:

id,

title,

price,

currency,

thumbnailUrl,

расстояние до пользователя (например, distanceMeters),

привязка к подкатегории (для фильтров).

фасеты по подкатегориям (для фильтра):

массив объектов: { subcategoryId, title, adsCount }.

Если сейчас фасетов нет — добавь либо:

через агрегирующий запрос в этот же endpoint,

либо отдельный endpoint /api/ads/nearby-facets.

4.2. Поведение при смене радиуса

При клике на кнопку радиуса:

обновляем локальное состояние radiusKm,

отправляем запрос на backend с новым значением,

список объявлений обновляется сразу.

Объявления остаются в рамках текущей категории и активных фильтров, меняется только радиус.

5. Фильтры (подгруппы/типы товаров)

Внизу экрана (как на скрине) должна быть кнопка “Фильтры”:

Кнопка в стиле чипа (скруглённый прямоугольник) с иконкой фильтра и подписью Фильтры.

При нажатии открывается модальное окно / bottom sheet с выбором подкатегорий.

5.1. Содержимое модалки фильтров

Заголовок: Фильтры или Фильтры категории.

Блок подкатегорий (вместо старого экрана подгрупп):

Список (можно в одну колонку или сетку) с элементами вида:

Название подкатегории:
Картофель, Морковь, Малина, Клубника, Огурцы, Перец и т.д. — реальные подкатегории из БД.

Справа или в углу — маленький бейдж-цифра, как на иконках приложений iOS:

показывает количество объявлений в этой подкатегории в рамках текущей категории и, по возможности, текущего радиуса.

пример: 7, 2, 15.

Пользователь может выбрать:

либо одну подкатегорию (самый простой вариант),

либо несколько (по желанию, но достаточно одной для начальной реализации).

Внизу модалки:

кнопка Сбросить (сбрасывает выбор подкатегорий),

кнопка Применить.

5.2. Применение фильтра

При нажатии Применить:

модалка закрывается,

обновляется список объявлений:

добавляем параметр subcategoryId (или список) в запрос на backend,

остаются активными:

текущий radiusKm,

текущий sort.

При Сбросить:

очищаем subcategoryId,

делаем запрос только по категории + радиусу + сортировке.

Важно: никаких отдельных экранов подгрупп больше нет — только через фильтры.

6. Сортировка

Рядом с кнопкой “Фильтры” внизу экрана — кнопка “Сортировка”:

Кнопка-чип с иконкой “две стрелки вверх-вниз” и текстом Сортировка.

При нажатии — модалка / bottom sheet с вариантами:

По расстоянию (по умолчанию)

По цене: от дешёвых к дорогим

По цене: от дорогих к дешёвым

По дате: сначала новые

(опционально) По дате: сначала старые

Выбранный вариант:

сохраняем в состоянии sort,

отображаем индикатор (например, подсвечиваем выбранный пункт или дублируем текущую сортировку мелким текстом на кнопке),

делаем запрос /api/ads/nearby с параметром sort=... и текущими:

categoryId,

radiusKm,

subcategoryId (если фильтр активен).

Обязательное условие: сортировка всегда работает в рамках выбранного радиуса и фильтров — мы не выходим за пределы радиуса при sort.

7. UI списка объявлений

Список объявлений в экране категории:

Карточка примерно как на скрине:

верхняя часть — фото товара (thumbnailUrl) на всю ширину карточки, с закруглёнными углами.

справа сверху иконка “избранное” (сердечко), если такая функциональность уже есть.

ниже:

цена: ₽250 / 80 BYN — из полей price и currency,

короткое название/описание: Свежие овощи с фермы,

строка с иконкой гео и текстом: 1.2 км от вас
(перевести distanceMeters → километры с 1 десятичным знаком).

Карточка кликабельна → открывает экран объявления.

Верстка:

адаптирована под мобильный экран Telegram MiniApp,

скруглённые углы, тень (если используется), отступы как в примере.

8. Состояния и обработка ошибок

Экран категории должен устойчиво работать:

Состояния:

isLoading (начальная загрузка),

isError (ошибка запроса),

ads (массив объявлений),

radiusKm,

sort,

selectedSubcategoryId / selectedSubcategories,

facets (для фильтров — список подкатегорий с counts).

При ошибке:

показываем аккуратный текст Не удалось загрузить объявления. Попробуйте обновить. + кнопку Повторить.

При пустом списке:

В выбранном радиусе пока нет объявлений в этой категории. Попробуйте изменить радиус или фильтры.

Геолокация:

если гео недоступно — можно:

показать сообщение Не удалось определить местоположение,

предложить “Повторить попытку”,

или сделать fallback, но для категории желательно иметь гео, чтобы честно считать расстояние.

9. Унификация для всех категорий

Всё описанное поведение должно работать одинаково для всех основных категорий:

Фермерский рынок,

Овощи/фрукты,

Выпечка,

Личные вещи,

Одежда,

Обувь,

Бытовые мелочи,

Телефоны & Электроника,

Сельхоз техника,

Услуги,

Аренда инструмента,

Даром отдаю,

и т.д.

То есть:

С главной нажимаем на любую категорию →
сразу открывается экран списка объявлений для этой категории.

Есть:

шапка с названием и стрелкой “назад”,

радиусы (300м–20км),

список объявлений,

внизу Фильтры и Сортировка.

Подкатегории живут только в фильтрах, с красивыми названиями и бейджами-цифрами количества товаров.

10. Результат

После твоих правок:

Подгрупповые экраны (когда после категории ещё один уровень выбора) — убраны.

Новый универсальный экран категории:

умеет работать с радиусами,

фильтрами по подкатегориям,

сортировкой,

обновляет список объявлений на лету.

Код аккуратный:

вынесенные компоненты (например, RadiusSelector, FiltersModal, SortModal, AdCard),

без лишних console.log в проде,

понятные комментарии в ключевых местах.

Если для этого нужно чуть доработать backend (/api/ads/nearby, фасеты по подкатегориям) — сделай необходимые изменения в Node.js + MongoDB, чтобы фронт мог полноценно работать по описанной логике.