PROMPT ДЛЯ REPLIT / CODEX

Задача: реализовать раздел “Мой магазин” в профиле MiniApp (WebView)

Ты — senior fullstack dev в проекте KETMAR Market (Telegram MiniApp + Web + backend на Node/TS).
Нужно реализовать полноценный кабинет “Мой магазин” для продавцов (фермеров, магазинов, частников) в профиле пользователя.

1. Встроить “Мой магазин” в профиль MiniApp

Где:
Профиль MiniApp → сейчас есть вкладки:

“Мои объявления”

“Избранное”

“Мой магазин” (сейчас пусто / заглушка)

Нужно:

Сделать красивую большую плашку “Мой магазин” в стиле нашего приложения (неон/матрица), адаптированную под WebView/mobile:

Если магазина ещё нет → показывать:

Заголовок: “Создай свой магазин”

Текст: “Размещай товары, продвигай свой Instagram и страницу, анализируй спрос вокруг себя”

Кнопка: “Открыть магазин”

Если магазин есть:

Логотип + название магазина

Статус: “Активен” / “На модерации” / “Отклонён” / “На паузе”

Кнопки:

“Перейти в кабинет магазина”

“Поставить магазин на паузу / Снять с паузы” (меняет статус и отключает публикации)

При нажатии “Открыть магазин” запускать мастер создания магазина (2–3 шага).

2. Модель данных для магазина

Создать сущность Shop (если уже есть — дорасширить):

type ShopStatus = 'pending' | 'approved' | 'rejected' | 'paused';

interface Shop {
  id: string;
  ownerUserId: string;

  name: string;                 // название магазина (обяз.)
  description: string;          // описание (обяз.)

  logoUrl?: string;             // логотип (необяз.)
  instagram?: string;           // ник/ссылка IG (необяз., но рекомендуемый)
  website?: string;             // опционально

  telegramUsername?: string;    // подтягиваем из профиля
  phone?: string;               // подтягиваем из профиля

  unp?: string;                 // УНП (необяз.)
  ownerFullName?: string;       // ФИО владельца (необяз.)

  // Локация магазина
  location: {
    lat: number;
    lng: number;
    city: string;
    district?: string;          // район
    addressLine?: string;       // человекочитаемый адрес
  };

  // Тип продавца для аналитики
  sellerType: 'farmer' | 'shop' | 'individual';

  status: ShopStatus;           // pending/approved/rejected/paused
  moderationComment?: string;

  createdAt: Date;
  updatedAt: Date;

  // Для будущей монетизации аналитики
  analyticsPlan: 'free' | 'pro' | 'max';
}

3. Мастер создания магазина (онбординг)

Сделать 2–3 шага в одном экране-вордшоте (React/TSX) с прогресс-баром.

Шаг 1 — Основная информация

Поля (валидация на фронте):

Название магазина (обяз.)

Описание магазина (обяз.)

Логотип (1 картинка, лучше квадрат) — загрузка как в объявлениях.

Instagram (строка, без строгой проверки, но подсказка: @username или ссылка)

Telegram / телефон

Автоматически подтягиваем из профиля пользователя:

telegramUsername

phone

Даем возможность отредактировать (но можно сделать read-only, если так логичнее по security).

УНП (необяз.)

ФИО владельца (необяз.)

Шаг 2 — Локация магазина

Используем текущую геолокацию (то, что уже есть в приложении):

Автоматически определяем lat/lng

Делаем обратное геокодирование → город + район → сохраняем

В форме отображаем:

“Ваш город: [город]”

“Район: [район]” (если есть)

Важно:
Карту НЕ рисуем (в твоём UX пожелании – без карты).
Только текст “Город / район” + иконка гео.

Для бэкенда сохраняем:

location.lat, location.lng, location.city, location.district, location.addressLine (если есть).

Шаг 3 — Подтверждение и отправка на модерацию

Показываем резюме:

Название, описание, локация, контакты

Чекбокс: “Я подтверждаю, что магазин реальный и буду соблюдать правила площадки” (можно позже повесить линк на правила).

Кнопка “Отправить на модерацию” → POST /shops

Бизнес-логика:

Новый магазин создается со статусом pending.

Владелец видит экран:

“Магазин на модерации”

Текст: “Администратор проверит ваш магазин и включит его в каталоге”.

До одобрения:

Пользователь НЕ может пользоваться функциями товаров/аналитики магазина.

Но может редактировать профиль магазина и заново отправлять на модерацию при rejected.

4. Панель суперадминистратора для модерации магазинов

Сделать административный интерфейс (может быть в существующей админке):

REST API (пример):

GET /admin/shops?status=pending — список новых магазинов

POST /admin/shops/:id/approve

POST /admin/shops/:id/reject (с полем moderationComment)

GET /admin/shops/:id — подробности

UI:

Таблица/список:

Название магазина

Тип продавца

Город/район

Instagram/телефон

Дата создания

Кнопки: “Одобрить” / “Отклонить”

При одобрении:

status = 'approved'

Магазин становится доступен в “Мой магазин” у продавца.

При отклонении:

status = 'rejected'

moderationComment отображать продавцу в кабинете.

5. Структура кабинета “Мой магазин”

После одобрения магазина, при заходе в “Мой магазин” у пользователя открывается кабинет магазина с табами:

Обзор (шапка + общая статистика)

Товары (карточки) — шаблоны товаров без цены

Публикации — активные объявления с ценой и количеством

Аналитика — графики по спросу/просмотрам

(В будущем) Ярмарки — подключение к сезонным кампаниям

Можно начать с 3-х основных вкладок: Обзор, Товары, Публикации, Аналитика.

6. Модель данных: Карточка товара vs Публикация

Разделяем шаблон товара и конкретные объявления:

6.1. Карточка товара (шаблон)
interface ProductTemplate {
  id: string;
  shopId: string;

  title: string;                 // название товара
  description: string;           // описание
  categoryId: string;            // категория из нашей иерархии
  photos: string[];              // до 4 фото
  tags?: string[];               // опционально
  seasonCode?: string;           // если есть сезоны (тюльпаны, НГ и т.д.)

  createdAt: Date;
  updatedAt: Date;
}


Особенности:

Здесь НЕТ цены и количества.

Продавец может заранее создать много карточек (разные цвета тюльпанов, разные наборы и т.п.).

6.2. Публикация (объявление по товару)
type ListingStatus = 'active' | 'paused' | 'finished';

interface Listing {
  id: string;
  shopId: string;
  productTemplateId: string;

  price: number;
  quantity: number;              // сколько штук/букетов
  status: ListingStatus;

  location: {
    lat: number;
    lng: number;
    city: string;
    district?: string;
  };                             // берем из магазина

  createdAt: Date;
  updatedAt: Date;
}

7. UX: создание карточек товаров

Во вкладке “Товары”:

Кнопка “Добавить товар”

Форма:

Название

Категория

Описание

До 4 фото

(Опционально: сезон, теги)

Кнопка “Сохранить карточку” → создаем ProductTemplate БЕЗ цены и количества.

Список карточек:

Фото + название

Метка: “Есть активные публикации” / “Нет публикаций”

Кнопки:

“Создать публикацию” (если нет активных)

“Открыть карточку” (редактирование описания/фото)

8. UX: массовая публикация товаров

Во вкладке “Публикации”:

Сделать специальный режим массовой публикации:

Показываем список всех ProductTemplate с чекбоксами:

 Товар 1 (фото + название)

 Товар 2

...

Продавец выбирает галочками, что хочет опубликовать.

Далее:

Для каждого выбранного товара:

Поле Цена

Поле Количество штук

Кнопка “Опубликовать выбранные товары”:

Создаем для каждого выбранного шаблона Listing с:

shopId

productTemplateId

price, quantity

location ← берем из Shop.location

status = 'active'

Отобразить успех: список созданных публикаций.

Потом, в блоке “Активные публикации”:

Список объявлений (как стандартные объявления в ленте, но с пометкой магазина).

Кнопки:

“Поставить на паузу”

“Возобновить”

“Завершить” (status = finished)

9. Аналитика магазина и объявлений

Нужно переиспользовать и расширить то, что уже делали в фермерском кабинете:

По каждому объявлению (Listing):

Общее количество просмотров

Количество добавлений в избранное

Количество “показов контактов” (если такая метрика есть)

График по дням:

дата → количество просмотров

География:

из каких районов/городов смотрели (разбивка)

средняя/макс дистанция от магазина до покупателя (расчет по координатам)

разбивка по дистанции:

0–2 км

2–5 км

5–10 км

10+ км

По магазину в целом:

Суммарные просмотры всех объявлений за выбранный период

Топ-товары по просмотрам

Динамика спроса (график)

Если есть модуль “динамика цены/средняя цена по рынку” из фермерского кабинета — подключить:

Показать, как цена по конкретной категории меняется по рынку

Показывать, ниже или выше рынка сейчас цена магазина

API (пример):

GET /shops/:id/analytics/overview?from=&to=

GET /shops/:id/listings/:listingId/analytics?from=&to=

Пока все эти графики доступны бесплатно для всех магазинов, но в модели уже предусмотрено поле analyticsPlan (free | pro | max), чтобы в будущем:

часть метрик/графиков переехать в платный пакет,

на фронте показывать “PRO”-бейджи и блокировку части аналитики.

10. Пауза магазина и монетизация в будущем

Бизнес-логика:

Если магазин в статусе paused:

Все его объявления Listing переводятся в paused (либо не показываются в ленте).

В кабинете магазина пользователь видит плашку “Магазин на паузе. Нажмите, чтобы возобновить.”

В будущем можно будет:

Ограничивать доступ к расширенной аналитике (на базе analyticsPlan).

Добавить баннер/CTA в кабинете:

“Хочешь видеть полную аналитику по районам и динамике цен по рынку? Подключи PRO.”
(Сейчас просто предусмотреть место в UI и флаг в данных, но не реализовывать оплату.)

11. Технические детали и требования

Фронтенд (MiniApp / WebView):

React/TS

Использовать уже существующие компоненты стилей (наш неон/матрица).

Всё адаптировать под мобильную вертикаль.

Не ломать существующую навигацию MiniApp.

Бэкенд:

Node.js / TypeScript

Использовать существующий userId из Telegram auth.

Ограничить создание магазина: 1 магазин на пользователя (пока так).

Все новые эндпоинты оформить в отдельном модуле shops (+ productTemplates, listings, analytics).

Соблюсти текущую архитектуру:

Писать код так, чтобы было легко переиспользовать аналитику фермерского кабинета.

Не дублировать логику цен/рынка — использовать те же сервисы, просто фильтруя по shopId/категории.

Если чего-то не хватает в данных — сам добавь минимальные поля, но сохраняй идею:

Магазин активируется через модерацию.

Товар = шаблон (карточка без цены).

Публикация = объявление с ценой и количеством, место берется из локации магазина.

По каждому объявлению и магазину видна подробная статистика (дата, район, расстояние, спрос), сейчас бесплатно, позже — монетизация через analyticsPlan.