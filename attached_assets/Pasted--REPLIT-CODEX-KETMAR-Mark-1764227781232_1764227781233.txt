ПРОМПТ ДЛЯ REPLIT / CODEX — ДИАГНОСТИКА ПРОЕКТА

Задача:
Проанализировать текущий проект KETMAR Market в этом реплите (бот + MiniApp + backend и т.д.) и подробно описать, что уже готово для:

Telegram MiniApp,

мобильного веб-приложения (браузерная версия),

возможного нативного мобильного приложения в будущем,
а также какие API и механизмы авторизации уже реализованы (SMS, Telegram и т.п.).

Цель анализа — понять, можем ли мы:

переиспользовать текущий MiniApp и его фронтенд, слегка адаптировав под мобильный веб-сайт,

или всё-таки нам нужно писать отдельную веб-версию сайта,
чтобы не дублировать код и не плодить лишние фронтенды.

1. Инфраструктура и архитектура проекта

Просканируй весь текущий проект:

какие есть директории (backend, bot, miniapp/web, etc.),

какие сервисы/части уже выделены (API-сервер, Telegram-бот, MiniApp frontend, что-то ещё),

есть ли Docker / docker-compose / конфиги для production.

Опиши общую архитектуру в виде текста:

есть ли единый backend API, к которому обращаются и MiniApp, и бот;

есть ли уже разделение на:

API для объявлений,

API для пользователей / авторизации,

API для геолокации,

API для ярмарок / фермеров / магазинов (если есть).

Укажи, есть ли уже настроенная структура под:

браузерную web-страницу (отдельный frontend),

MiniApp (Telegram WebApp) — какие директории/файлы за это отвечают.

2. Объявления, база данных и единое ядро

Нам нужно, чтобы объявления были едиными:

если человек создал объявление в MiniApp → оно сразу видно на сайте,

если опубликовал на сайте → видно в MiniApp (и потенциально в других клиентах).

Пожалуйста:

Найди, как сейчас устроены объявления:

где находится модель/схема объявления (например, в MongoDB — Mongoose схема),

какие поля есть у объявления (цена, фото, гео-координаты, продавец, тип: фермер / магазин / частник, и т.д.).

Опиши, какие API-эндпоинты уже есть для объявлений:

создание,

получение списка (с фильтрами и без),

получение по ID,

обновление/удаление (если реализовано).

Ответь явно:

Сейчас фронтенд MiniApp и потенциальный сайт используют один и тот же backend и одну и ту же БД?

Есть ли уже что-то, что мешает нам сделать единое ядро для всех клиентов?

Напиши, можем ли мы просто добавить ещё один frontend-клиент (мобильный веб-сайт) поверх текущего API, чтобы:

объявления были общие,

логика работы осталась общей (гео, фильтры и т.д.).

3. Telegram MiniApp: что готово

Найди код, который отвечает за Telegram MiniApp (WebApp):

фронтенд (React/Vite/другой фреймворк),

логику инициализации через Telegram.WebApp,

работу с initData / initDataUnsafe, если уже реализовано.

Опиши:

какая сейчас структура MiniApp-страниц (главная, карточки, категории, ярмарки и т.д.),

какие компоненты/экраны уже есть,

как реализована работа с геолокацией (есть ли уже привязка к точке пользователя, визуал по гео).

Ответь:
Насколько просто переиспользовать код MiniApp как основу для мобильного веб-сайта?

Можно ли вынести общие компоненты (карточки объявлений, ленту, фильтры, шапку и т.д.) в «общую» часть,

а затем сделать:

один вариант обёртки для MiniApp,

второй — для обычного браузера (мобильный сайт)?

Сделай честную оценку:

что уже годится «как есть» для веб-сайта,

что придётся дописывать / переписывать.

4. Авторизация: SMS, Telegram, другие методы

Очень важно понять, что уже реализовано по авторизации.

Найди все части проекта, связанные с авторизацией и пользователями:

модели пользователя (user),

эндпоинты /auth/* (или похожие),

использование JWT/сессий.

Отдельно опиши:

4.1. Авторизация через SMS / телефон

Есть ли уже:

запрос на отправку SMS-кода (/auth/phone/request_code или похожий),

проверка кода (/auth/phone/verify),

логика создания пользователя/сессии по телефону?

Если есть, опиши:

какие именно эндпоинты,

как работает flow,

какие env-переменные нужны (SMS-провайдер и т.п.).

4.2. Авторизация через Telegram

Есть ли:

авторизация через initData MiniApp (подпись Telegram)?

авторизация через бота с deep link (start=<token> и выдача токена для сайта/MiniApp)?

Если уже есть какая-то реализация, опиши:

куда приходят данные Telegram (user_id, username, phone),

как они мапятся на пользователя в БД,

как выдаётся токен для фронтенда.

Ответь, что из этого можно уже использовать для будущего веб-сайта:

можем ли мы:

при входе на сайт отправлять пользователя в Telegram (deep link к боту),

подтверждать вход,

возвращаться на сайт с токеном?

и/или просто использовать текущие методы SMS-авторизации?

5. Геолокация и привязка к региону

Мы хотим UX как в Яндекс Go: всё крутится вокруг точки, где находится пользователь (город/район, радиус и т.д.).

Найди, как сейчас обрабатывается геолокация:

есть ли поля в моделях (lat, lng, city, region),

есть ли уже готовые API для:

поиска объявлений по координатам и радиусу,

получения ярмарок/событий по региону.

Опиши:

есть ли в MiniApp уже логика «покажи объявления рядом»,

как сейчас определяется город/регион (по координатам, вручную, не реализовано?).

Ответь, можем ли мы эту же гео-логику использовать и для веб-сайта, не переписывая backend:

если да — какие конкретно эндпоинты будут использоваться,

если нет — что нужно добавить в backend.

6. Рекомендации по стратегии: адаптация MiniApp vs отдельный сайт

С учётом всего выше:

Дай чёткий вывод:

Лучше:

А) адаптировать существующий MiniApp под мобильный веб-сайт (выделить общий UI-код + 2 точки входа: MiniApp и веб),

или

Б) писать отдельный frontend для мобильного сайта, просто используя существующий backend?

Объясни:

что конкретно уже готово и помогает варианту А,

какие риски/сложности у варианта А (инициализация через Telegram WebApp, завязка на Telegram API, глобальные объекты и т.д.),

что проще/быстрее по времени для нас с учётом текущего состояния проекта.

Дай примерный список задач:

если идём по пути адаптации MiniApp (вариант А),

если идём по пути отдельного веб-фронтенда (вариант Б).

7. Формат ответа

Пожалуйста, ответь структурировано, с заголовками:

Архитектура проекта (что уже есть)

Объявления и общая БД (единое ядро)

MiniApp: состояние и возможность адаптации

Авторизация (SMS / Telegram)

Геолокация и работа с регионом

Рекомендации: адаптировать MiniApp vs отдельный сайт

Список задач для выбранной стратегии

Не пиши код на этом этапе — только анализ и выводы.
Код и конкретную реализацию будем делать следующим шагом, после твоего анализа.