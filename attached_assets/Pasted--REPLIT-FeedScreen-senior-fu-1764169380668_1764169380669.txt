–ü–†–û–ú–¢ –î–õ–Ø REPLIT: –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨ –õ–ï–ù–¢–£ (FeedScreen) –° –¢–ò–ö–¢–û–ö-–°–í–ê–ô–ü–ê–ú–ò, –õ–ê–ô–ö–ê–ú–ò –ò –õ–û–ì–ê–ú–ò

–¢—ã ‚Äî senior full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (Node.js + Express + MongoDB + React).
–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫—É ‚Äú–õ–µ–Ω—Ç–∞‚Äù –≤ MiniApp KETMAR –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É TikTok:

–æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω,

—Å–≤–∞–π–ø—ã –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑,

–ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫,

–æ—Ç–∫—Ä—ã—Ç–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ —Ñ–æ—Ç–æ,

–≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–¥–∏—É—Å–µ 20 –∫–º,

–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ user_feed_events –¥–ª—è –±—É–¥—É—â–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.

–ù–∏–∂–µ ‚Äî —á—ë—Ç–∫–æ–µ –¢–ó, –¥–µ–ª–∞–π –ø–æ –Ω–µ–º—É.

0. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)

Backend: Node.js (JS/TS) + Express + MongoDB/Mongoose.

Frontend: React (Vite) –≤ –≤–∏–¥–µ Telegram MiniApp.

–£–∂–µ –µ—Å—Ç—å:

–º–æ–¥–µ–ª—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è Ad (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥),

–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –≤ –≤–∏–¥–µ geo: { type: "Point", coordinates: [lng, lat] } —Å 2dsphere-–∏–Ω–¥–µ–∫—Å–æ–º,

–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram (initData / JWT),

–Ω–∏–∂–Ω–∏–π —Ç–∞–±-–±–∞—Ä: –ì–ª–∞–≤–Ω–∞—è / –õ–µ–Ω—Ç–∞ / –ú–æ–∏ / –ò–∑–±—Ä–∞–Ω–Ω–æ–µ / –ü—Ä–æ—Ñ–∏–ª—å.

–ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –¥–µ—Ç–∞–ª–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∏–Ω–∞—á–µ ‚Äî –∞–¥–∞–ø—Ç–∏—Ä—É–π –∫–æ–¥, –Ω–æ –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–∏.

1. Backend: API –¥–ª—è –ª–µ–Ω—Ç—ã /api/feed
1.1. –ù–æ–≤—ã–π endpoint

–†–µ–∞–ª–∏–∑—É–π endpoint:

GET /api/feed

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

radiusKm (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20).

limit (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20‚Äì30).

cursor –∏–ª–∏ offset (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ‚Äî –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –∏ —Ä–µ–∞–ª–∏–∑—É–π –µ–≥–æ).

–ü—Ä–∏–º–µ—Ä:
GET /api/feed?radiusKm=20&limit=20&cursor=...

1.2. –ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å endpoint

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–∏–∑ auth-middleware (–Ω–∞–ø—Ä–∏–º–µ—Ä, req.user.id),

–ª–∏–±–æ –∏–∑ Telegram initData —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–≤–∑—è—Ç—å lat/lng –∏–∑:

—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,

–∏–ª–∏ –∏–∑ query/headers (–µ—Å–ª–∏ —Ç–∞–∫ —É –≤–∞—Å –ø—Ä–∏–Ω—è—Ç–æ),

–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤–µ—Ä–Ω—É—Ç—å 400 —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π.

–ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–¥–∏—É—Å–µ radiusKm:

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å $geoNear –∏–ª–∏ $near –ø–æ –ø–æ–ª—é geo (2dsphere –∏–Ω–¥–µ–∫—Å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û),

—Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è: —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ/–∞–∫—Ç–∏–≤–Ω—ã–µ,

–Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –Ω–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ü–µ–Ω–µ ‚Äî —ç—Ç–æ –æ–±—â–∞—è –ª–µ–Ω—Ç–∞.

–ë–∞–∑–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:

–Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ ‚Äî –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ –≤—ã—à–µ),

–ª–∏–±–æ random/–ø—Å–µ–≤–¥–æ—Ä–∞–Ω–¥–æ–º (–Ω–∞ —Ç–≤–æ–π –≤—ã–±–æ—Ä, –Ω–æ –æ–ø–∏—à–∏ –≤ –∫–æ–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, —á—Ç–æ —ç—Ç–æ –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏).

–ü–∞–≥–∏–Ω–∞—Ü–∏—è:

–≤–∞—Ä–∏–∞–Ω—Ç 1: offset + limit,

–≤–∞—Ä–∏–∞–Ω—Ç 2: cursor (id –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è + createdAt),

–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥ –∏ —Ä–µ–∞–ª–∏–∑—É–π –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–í –æ—Ç–≤–µ—Ç–µ –≤–µ—Ä–Ω–∏:

items: –º–∞—Å—Å–∏–≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–π,

nextCursor –∏–ª–∏ nextOffset (–µ—Å–ª–∏ –µ—Å—Ç—å –µ—â—ë –¥–∞–Ω–Ω—ã–µ).

1.3. –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—É—Ç—å –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—é

–í–µ—Ä–Ω–∏ –º–∏–Ω–∏–º—É–º:

_id

title

images (–º–∞—Å—Å–∏–≤ URL, –Ω–∞–º –Ω—É–∂–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ç–∫–∞)

city

district / area (—Ä–∞–π–æ–Ω, —Ç–∏–ø–∞ –í—É–ª—å–∫–∞, –¶–µ–Ω—Ç—Ä –∏ —Ç.–ø.)

geo (–¥–ª—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è)

categoryId / categoryCode

createdAt

price, currency (–º–æ–∂–µ–º –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –ª–µ–Ω—Ç–µ, –Ω–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è)

distanceMeters (–∏–∑ $geoNear) ‚Äî –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.

2. Backend: –º–æ–¥–µ–ª—å –∏ API –¥–ª—è –ª–æ–≥–æ–≤ user_feed_events
2.1. –ù–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è UserFeedEvent

–°–æ–∑–¥–∞–π Mongoose-–º–æ–¥–µ–ª—å (–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ –≤–∫—É—Å—É, –Ω–æ —Å–º—ã—Å–ª —Ç–∞–∫–æ–π):

user_feed_events —Å –ø–æ–ª—è–º–∏:

userId ‚Äî ObjectId –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ).

adId ‚Äî ObjectId –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ).

eventType ‚Äî —Å—Ç—Ä–æ–∫–∞, –æ–¥–Ω–æ –∏–∑:

"impression" ‚Äî –ø–æ–∫–∞–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ª–µ–Ω—Ç–µ,

"view_open" ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è,

"like" ‚Äî –ª–∞–π–∫,

"dislike" ‚Äî –¥–∏–∑–ª–∞–π–∫,

"scroll_next" ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—ä—è–≤–ª–µ–Ω–∏—é,

"scroll_prev" ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –æ–±—ä—è–≤–ª–µ–Ω–∏—é.

dwellTimeMs (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±—ã–ª–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–¥–ª—è impression).

positionIndex (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ª–µ–Ω—Ç–µ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–±—ã—Ç–∏—è.

radiusKm ‚Äî —Ä–∞–¥–∏—É—Å –ª–µ–Ω—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20).

createdAt ‚Äî –¥–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Date.now).

meta ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ (Mixed/Map) –¥–ª—è –¥–æ–ø. –∏–Ω—Ñ–æ:

–∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Ç.–ø.

–°–¥–µ–ª–∞–π –∏–Ω–¥–µ–∫—Å—ã:

–ø–æ userId,

–ø–æ adId,

–ø–æ eventType,

–º–æ–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–Ω–æ–π userId + adId + eventType.

2.2. Endpoint –¥–ª—è –ø—Ä–∏—ë–º–∞ —Å–æ–±—ã—Ç–∏–π

–°–¥–µ–ª–∞–π endpoint:

POST /api/feed/events

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

{
  "events": [
    {
      "adId": "...",
      "eventType": "impression" | "view_open" | "like" | "dislike" | "scroll_next" | "scroll_prev",
      "dwellTimeMs": 1234,
      "positionIndex": 5,
      "radiusKm": 20,
      "meta": { "categoryCode": "farmer_market" }
    }
  ]
}


–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (req.user.id) ‚Äî –Ω–µ –ø–µ—Ä–µ–¥–∞—ë–º userId —Å —Ñ—Ä–æ–Ω—Ç–∞.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å batch –≤—Å—Ç–∞–≤–∫—É:

events ‚Äî –º–∞—Å—Å–∏–≤.

–ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç 1 —Å–æ–±—ã—Ç–∏–µ ‚Äî –º–∞—Å—Å–∏–≤ –¥–ª–∏–Ω–æ–π 1.

–í–∞–ª–∏–¥–∞—Ü–∏—è:

–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: adId, eventType,

eventType –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

—Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ user_feed_events,

–≤–µ—Ä–Ω—É—Ç—å { success: true, saved: N }.

–û—à–∏–±–∫–∞ ‚Äî –≤–µ—Ä–Ω—É—Ç—å { success: false, error: ... }.

3. Frontend: –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω FeedScreen (–≤–∫–ª–∞–¥–∫–∞ ¬´–õ–µ–Ω—Ç–∞¬ª)
3.1. –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –Ω–∏–∂–Ω–∏–π —Ç–∞–±-–±–∞—Ä (–ì–ª–∞–≤–Ω–∞—è / –õ–µ–Ω—Ç–∞ / –ú–æ–∏ / –ò–∑–±—Ä–∞–Ω–Ω–æ–µ / –ü—Ä–æ—Ñ–∏–ª—å).

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Ç–∞–± ¬´–õ–µ–Ω—Ç–∞¬ª:

—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è FeedScreen,

–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —É–ø—Ä–æ—â–∞–µ—Ç—Å—è:

—Ç–æ–ª—å–∫–æ –Ω–∞–¥–ø–∏—Å—å KETMAR –∏ –∏–∫–æ–Ω–∫–∞ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è),

–±–µ–∑ —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞,

–Ω–∏–∂–Ω–∏–π —Ç–∞–±-–±–∞—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º).

3.2. Layout FeedScreen

–°–¥–µ–ª–∞–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç FeedScreen —Å —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

const FeedScreen = () => {
  return (
    <div className="feed-root">
      <header className="feed-header">
        {/* —Å–ª–µ–≤–∞ –ª–æ–≥–æ—Ç–∏–ø/–Ω–∞–∑–≤–∞–Ω–∏–µ KETMAR, —Å–ø—Ä–∞–≤–∞ –∏–∫–æ–Ω–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */}
      </header>

      <main className="feed-content">
        {/* —Å–≤–∞–π–ø–æ–≤–∞—è –ª–µ–Ω—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π */}
      </main>

      {/* –Ω–∏–∂–Ω–∏–π —Ç–∞–±–±–∞—Ä —É–∂–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –æ–±—â–∏–º layout'–æ–º, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º */}
    </div>
  );
};


–°—Ç–∏–ª–∏ (–∏–¥–µ—è):

.feed-root ‚Äî display: flex; flex-direction: column; height: 100%;

.feed-header ‚Äî —Ñ–∏–∫—Å. –≤—ã—Å–æ—Ç–∞, –ù–ï —Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è.

.feed-content ‚Äî flex: 1; overflow: hidden;
(–≤–Ω—É—Ç—Ä–∏ –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–≤–∞–π–ø–æ–≤, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π scroll-list).

4. Frontend: –ª–æ–≥–∏–∫–∞ —Å–≤–∞–π–ø–æ–≤ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫
4.1. –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–í FeedScreen:

const [items, setItems] = useState<AdFeedItem[]>([]) ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π.

const [currentIndex, setCurrentIndex] = useState(0) ‚Äî –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏.

const [isLoading, setIsLoading] = useState(true) –∏ —Ç.–ø.

const [nextCursor, setNextCursor] = useState<string | null>(null) ‚Äî –¥–ª—è –¥–æ–≥—Ä—É–∑–∫–∏.

4.2. –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–Ω—Ç—ã

–ü—Ä–∏ mount:

–ó–∞–ø—Ä–æ—Å–∏—Ç—å /api/feed?radiusKm=20&limit=....

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å items, nextCursor.

–ü–æ—Å—Ç–∞–≤–∏—Ç—å currentIndex = 0.

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ impression –¥–ª—è items[0] (—Å–º. —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).

–ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –∫–æ–Ω—Ü—É –º–∞—Å—Å–∏–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å + 3 >= items.length):

–µ—Å–ª–∏ –µ—Å—Ç—å nextCursor ‚Äî —Å–¥–µ–ª–∞—Ç—å follow-up –∑–∞–ø—Ä–æ—Å /api/feed?cursor=... –∏ –∞–ø–ø–µ–Ω–¥–∏—Ç—å –∫ items.

4.3. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

–ö–∞—Ä—Ç–æ—á–∫–∞ (–∫ –ø—Ä–∏–º–µ—Ä—É, FeedCard):

–∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—á—Ç–∏ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É feed-content,

—Ñ–æ–Ω ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (item.images[0]), —Å object-fit: cover,

–ø–æ–≤–µ—Ä—Ö —Ñ–æ—Ç–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É/—Å–ø—Ä–∞–≤–∞ ‚Äî –¥–≤–µ –∫–Ω–æ–ø–∫–∏:

üëç –õ–∞–π–∫ (onLike)

üëé –î–∏–∑–ª–∞–π–∫ (onDislike)

–≤–Ω–∏–∑—É (–Ω–∞–¥ –Ω–∏–∂–Ω–∏–º —Ç–∞–±-–±–∞—Ä–æ–º) –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ø–ª–∞—à–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º –ª–æ–∫–∞—Ü–∏–∏:

–ë—Ä–µ—Å—Ç (–í—É–ª—å–∫–∞) –∏–ª–∏ city + (district).

–ü–æ –∫–ª–∏–∫—É –Ω–∞ —Å–∞–º—É –∫–∞—Ä—Ç–æ—á–∫—É/—Ñ–æ—Ç–æ:

–æ—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—ã–π/—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–∫—Ä–∞–Ω –æ–±—ä—è–≤–ª–µ–Ω–∏—è (AdDetail / AdPage),

–ø–µ—Ä–µ–¥–∞—Ç—å adId.

–í–∞–∂–Ω–æ: –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:

FeedScreen –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å currentIndex –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ç–æ–≥–æ –∂–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

4.4. –°–≤–∞–π–ø—ã

–†–µ–∞–ª–∏–∑—É–π —Å–≤–∞–π–ø—ã –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (–∫–∞–∫ –≤ TikTok):

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ react-swipeable –∏–ª–∏ —Å–≤–æ—é –æ–±—Ä–∞–±–æ—Ç–∫—É onTouchStart / onTouchEnd:

—Å–≤–∞–π–ø –≤–≤–µ—Ä—Ö ‚Üí setCurrentIndex(prev => prev + 1) (–µ—Å–ª–∏ –Ω–µ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞),

—Å–≤–∞–π–ø –≤–Ω–∏–∑ ‚Üí setCurrentIndex(prev => prev - 1) (–µ—Å–ª–∏ > 0).

–ü—Ä–∏ —Å–º–µ–Ω–µ currentIndex:

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ scroll_next –∏–ª–∏ scroll_prev,

–∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Äî –ø–æ—Å—á–∏—Ç–∞—Ç—å dwellTimeMs –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π impression-event (—Å–º. –Ω–∏–∂–µ).

–°–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –±—ã–ª–∞ —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞, –±–µ–∑ ‚Äú–ø–æ–ª—É–∫–∞—Ä—Ç–æ—á–µ–∫‚Äù —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É.

5. Frontend: —Å–æ–±—ã—Ç–∏—è –ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5.1. –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ª–µ–Ω—Ç–µ –ª–æ–≥–∏—Ä—É–µ–º:

impression ‚Äî –∫–æ–≥–¥–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–ø–µ—Ä–≤—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω–∞ (–ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å).

–í meta –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å:

categoryCode, city, district.

dwellTimeMs ‚Äî –≤—Ä–µ–º—è –º–µ–∂–¥—É –ø–æ–∫–∞–∑–æ–º –∏ —É—Ö–æ–¥–æ–º (—Å–º–µ–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —ç–∫—Ä–∞–Ω–∞).

view_open ‚Äî –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –Ω–∞ —Ñ–æ—Ç–æ –∏ –æ—Ç–∫—Ä—ã–ª –∫–∞—Ä—Ç–æ—á–∫—É.

like ‚Äî –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –ª–∞–π–∫.

dislike ‚Äî –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –¥–∏–∑–ª–∞–π–∫.

scroll_next / scroll_prev ‚Äî –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–∞ —Å–≤–∞–π–ø–æ–º.

5.2. –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

–í FeedScreen:

const [currentStartTime, setCurrentStartTime] = useState<number | null>(null);

–ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É (–º–µ–Ω—è–µ—Ç—Å—è currentIndex):

–µ—Å–ª–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –±—ã–ª currentStartTime:

–≤—ã—á–∏—Å–ª–∏—Ç—å dwellTimeMs = Date.now() - currentStartTime,

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ impression –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ adId —Å —ç—Ç–∏–º dwellTimeMs (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏).

—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å currentStartTime = Date.now() –¥–ª—è –Ω–æ–≤–æ–≥–æ currentIndex,

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ impression –±–µ–∑ dwellTime –∏–ª–∏ —Å 0 (–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ–∑–∂–µ ‚Äî –≤—ã–±–µ—Ä–∏ —É–¥–æ–±–Ω—É—é —Å—Ö–µ–º—É).

–ü—Ä–∏ —Å–≤–∞–π–ø–µ:

–µ—Å–ª–∏ index —É–≤–µ–ª–∏—á–∏–ª—Å—è ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ scroll_next,

–µ—Å–ª–∏ —É–º–µ–Ω—å—à–∏–ª—Å—è ‚Üí scroll_prev.

–ü—Ä–∏ –ª–∞–π–∫–µ:

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å POST /api/feed/events —Å eventType "like" –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ adId.

–ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–æ–º–µ—Ç–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–∞–∫ ‚Äúliked‚Äù –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å—Ç–µ–π—Ç–µ (–¥–ª—è UI).

–ü—Ä–∏ –¥–∏–∑–ª–∞–π–∫–µ:

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å "dislike",

–ø–æ–∫–∞ –Ω–∏ –Ω–∞ —á—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç—å, —Ç–æ–ª—å–∫–æ –ª–æ–≥.

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:

–ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ:

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å "view_open",

–æ—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

–°–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–∞—Ç—á–∞–º–∏ (–∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –º–∞—Å—Å–∏–≤ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–ª–∞—Ç—å) –∏–ª–∏ –ø–æ –æ–¥–Ω–æ–º—É ‚Äî —Å–¥–µ–ª–∞–π –ø—Ä–æ—Å—Ç–æ–π –Ω–∞–¥—ë–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –±–∞—Ç—á–∞–º–∏).

5.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω—ã –ª–æ–º–∞—Ç—å –ª–µ–Ω—Ç—É.

–ï—Å–ª–∏ POST /api/feed/events –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ª–æ–≥–∏—Ä—É–π –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π.

6. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –≤ –ª–µ–Ω—Ç–µ

–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–π —Å—Ç—Ä–æ–∫—É –ª–æ–∫–∞—Ü–∏–∏:

const locationLabel = district
  ? `${city} (${district})`
  : city || '–õ–æ–∫–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞';


–û—Ç–æ–±—Ä–∞–∑–∏ —ç—Ç–æ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ –Ω–∞ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –ø–ª–∞—à–∫–µ –ø–æ–≤–µ—Ä—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.

–ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (distanceMeters):

–º–æ–∂–Ω–æ –¥–æ–ø–∏—Å–∞—Ç—å:
–ë—Ä–µ—Å—Ç (–í—É–ª—å–∫–∞) ¬∑ 1.2 –∫–º –æ—Ç –≤–∞—Å.

7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –º–∞–ª–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π

–ï—Å–ª–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ —Ä–∞–¥–∏—É—Å–µ 20 –∫–º –º–∞–ª–æ:

–≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ, —á—Ç–æ –µ—Å—Ç—å, –≤ –ø–æ—Ä—è–¥–∫–µ –æ—Ç backend‚Äôa.

–ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫ –≤—Å—ë —Ä–∞–≤–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –≤—ã–¥–∞—á—É.

–ï—Å–ª–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç:

–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π —ç–∫—Ä–∞–Ω-–∑–∞–≥–ª—É—à–∫—É:

–í —Ä–∞–¥–∏—É—Å–µ 20 –∫–º –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ —Ä–∞–∑–¥–µ–ª—ã.

–∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ì–ª–∞–≤–Ω—É—é.

8. –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞

–í—ã–Ω–µ—Å–∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ —á–∞—Å—Ç–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

FeedCard,

FeedHeader,

—Ö—É–∫ useFeed (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ + –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ —É–¥–æ–±–Ω–æ).

–ù–µ –æ—Å—Ç–∞–≤–ª—è–π console.log –≤ –ø—Ä–æ–¥–æ–≤–æ–π —á–∞—Å—Ç–∏ –∫–æ–¥–∞, —Ç–æ–ª—å–∫–æ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ debug-–∫–æ–º–º–µ–Ω—Ç—ã.

–í—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ (radiusKm, limit, –ø–æ—Ä–æ–≥ –¥–æ–≥—Ä—É–∑–∫–∏ –∏ —Ç.–¥.) –≤—ã–Ω–µ—Å–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–æ–¥–ø–∏—à–∏.

–°–¥–µ–ª–∞–π –≤—Å—ë —ç—Ç–æ –∫–∞–∫ –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
–ø–æ—Å–ª–µ —Ç–≤–æ–∏—Ö –ø—Ä–∞–≤–æ–∫ –≤–∫–ª–∞–¥–∫–∞ ¬´–õ–µ–Ω—Ç–∞¬ª –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π TikTok-–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –±–∞–∑–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.