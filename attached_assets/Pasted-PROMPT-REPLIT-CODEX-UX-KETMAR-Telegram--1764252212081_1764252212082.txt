PROMPT ДЛЯ REPLIT / CODEX

Задача: доработать UX/верстку формы подачи объявления в KETMAR (Telegram MiniApp / mobile web), не ломая существующую логику, API и дизайн.

Работаем только в экранах создания объявления (wizard «Подать объявление») и связанных компонент. Никакой рефакторинг «всего проекта» не делать.

1. Фиксированные (статические) верхняя и нижняя панели

Требование:

На всех шагах мастера «Подать объявление»:

Верхняя панель с логотипом KETMAR, колокольчиком и заголовком текущего шага (например, «Подача объявления») должна всегда оставаться на экране (fixed / sticky).

Нижняя панель навигации (табы типа: «Главная», «Лента», «Мои», «Избранное», «Профиль» — как сейчас реализовано) тоже должна быть всегда видна, не прокручиваться и не исчезать.

Скролл должен происходить только внутри центральной зоны между верхней и нижней панелью.

Технически:

Оставить существующую разметку и стили по максимуму.

Центральный контент-область (форма шага) сделать scrollable:

Например, layout:

wrapper (100vh, flex-column),

Header (fixed height, не скроллится),

ScrollableContent (flex:1, overflow-y:auto; с padding-bottom под нижнюю панель),

BottomTabs (fixed height, не скроллится).

Не менять маршрутную логику, только верстку/позиционирование.

2. Автоопределение геолокации при старте мастера

Требование:

Когда пользователь нажимает «Подать объявление» и открывается первый шаг мастера:

Сразу (автоматически) вызвать существующую логику автоопределения геопозиции пользователя.

После успешного определения – подставить город и район, как это уже реализовано сейчас (раньше).

Убрать необходимость выбирать город из списка вручную (если автоопределение сработало).

Кнопку/действие типа «ДАЛЕЕ» оставить как есть (только пользователь уже не должен выбирать город руками, если всё определилось).

Важно:

Использовать уже существующий метод/geolocation-сервис, не переписывать всю гео-логику.

При ошибке геолокации – оставить текущий fallback (как сейчас), без дополнительных больших изменений.

3. Блок фотографий: добавить возможность выбора главной (перетаскивание)

Текущее поведение (оставить):

Пользователь может загрузить 3–4 фотографии (или тот лимит, который сейчас стоит).

Превью фото отображаются в виде карточек/квадратиков.

Нужно добавить:

Возможность перетаскивать (drag & drop) фотографии внутри блока превью, чтобы менять их порядок.

Первая фотография в массиве/списке должна считаться главной обложкой объявления.

При сохранении формы порядок должен учитываться так, как пользователь расставил.

Технически:

Использовать легкий drag-and-drop (например, через уже используемую в проекте библиотеку, либо нативно).

Не менять структуру данных, только порядок массива photos (например, при drop пересортировать).

UI оставить визуально максимально похожим на текущий.

4. Работа клавиатуры: скрытие по Enter/Done

Требование:

Для всех шагов мастера, где есть поля:

«Что продаете» (заголовок объявления),

«Цена»,

«Описание»,

нужно:

При нажатии Enter / Done на клавиатуре:

Скрывать клавиатуру (вызывать blur() на соответствующем input/textarea).

Верхняя и нижняя панель при этом не должны дергаться/исчезать — остаются статичными, как в пункте 1.

Технически (web/React):

На текстовых полях и числовом поле цены:

добавить обработчик onKeyDown или аналогичный,

если event.key === 'Enter':

event.preventDefault(),

вызвать inputRef.current?.blur() (или текущий способ).

В React Native (если используется) — обработать onSubmitEditing и вызывать Keyboard.dismiss().

5. Поведение кнопки «Опубликовать»

Текущее поведение:

При нажатии «Опубликовать» сейчас можно нажать два-три раза, пока идёт запрос.

Нужно сделать:

При первом нажатии на кнопку «Опубликовать»:

Сразу перевести кнопку в состояние disabled / loading.

Запретить повторные нажатия (debounce через состояние isSubmitting).

Пока идет запрос:

кнопка визуально неактивна (можно показать индикатор загрузки, если это уже используется в проекте).

После успешной публикации:

Скрыть или отключить кнопку «Опубликовать» (не давать нажимать повторно).

Показать уведомление/тост:
«Ваше объявление опубликовано».

Автоматически переключить пользователя на экран «Мои объявления» (вкладка/страница с его объявлениями).

При ошибке публикации:

Показать существующее уведомление об ошибке (если уже есть).

Снова разблокировать кнопку, чтобы пользователь мог повторить попытку.

Технически:

Добавить локальный стейт isSubmitting в компоненте последнего шага:

isSubmitting = true при первом клике.

В finally после API-запроса:

если успех – редирект на «Мои объявления» и не возвращать кнопку в активное состояние,

если ошибка – isSubmitting = false.

Не менять структуру API-вызова, только обернуть его в состояние.

6. Общие ограничения (очень важно)

Не трогать:

backend-API (эндпоинты, DTO, контракт);

роутинг и логику переходов между экранами (кроме добавления перехода на «Мои объявления» после успеха);

бизнес-логику мастера (шаги, валидация) — всё оставить как есть.

Все изменения должны быть минимально инвазивными:

только правки верстки (sticky header/footer),

добавление drag-and-drop для фотографий,

обработчики клавиатуры,

защита от повторного нажатия «Опубликовать».

Дизайн, цвета, шрифты, иконки – оставить существующие.

Результат:
Обновлённые компоненты экранов подачи объявления, где:

верхняя панель KETMAR + колокольчик и нижняя навигация всегда статичны;

геолокация подставляется автоматически при входе в мастер;

фотографии можно перетаскивать, выбирая главную;

клавиатура скрывается по Enter в полях «что продаете», «цена», «описание»;

кнопка «Опубликовать» не даёт делать двойные клики и после успеха показывает сообщение и переводит в «Мои объявления».