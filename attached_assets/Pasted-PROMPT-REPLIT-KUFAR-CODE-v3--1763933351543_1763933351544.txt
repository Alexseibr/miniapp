PROMPT –î–õ–Ø REPLIT: KUFAR-CODE v3 (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º)

–•–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –º–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ KUFAR-CODE –Ω–∞ –±–∞–∑–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞.
–ù—É–∂–Ω–æ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Å—ë —Å –Ω—É–ª—è, –∞ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∏ —É–ª—É—á—à–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—è:

—Ç–µ–∫—É—â—É—é –º–æ–Ω–æ—Ä–µ–ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

backend (Express + MongoDB)

–±–æ—Ç (Telegraf)

–º–∏–Ω–∏–∞–ø–ø (React + Vite)

web (React + Vite)

–ø–æ–¥–¥–µ—Ä–∂–∫—É GeoJSON, 2dsphere

–ø–æ–¥–¥–µ—Ä–∂–∫—É seasonCode

layout-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–æ–≤

initData –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

—Å–∏—Å—Ç–µ–º—É –≥–æ—Ä–æ–¥–æ–≤

—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

üéØ –¶–µ–ª–∏ PROMPT‚Äô–∞

–î–æ–±–∞–≤–∏—Ç—å –∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â—ë –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–ª –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π:

‚úî Server-Driven UI (–±–ª–æ–∫–∏ —ç–∫—Ä–∞–Ω–æ–≤ –∏–∑ backend)
‚úî –º–Ω–æ–≥–æ–≥–æ—Ä–æ–¥–æ–≤–æ—Å—Ç—å (City + CityLayout)
‚úî —Å–µ–∑–æ–Ω–Ω—ã–µ –≤–∏—Ç—Ä–∏–Ω—ã (seasonCode)
‚úî geo-search + recommendations
‚úî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MiniApp ‚Üî Bot
‚úî web + miniapp —á–∏—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ layout‚Äô—ã
‚úî —á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
‚úî –µ–¥–∏–Ω—ã–µ —Ç–∏–ø—ã (shared/)
‚úî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –Ω–∞—à–∏–º —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º –Ω–∞ GitHub
üì¶ 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é, –Ω–æ –¥–æ–ø–æ–ª–Ω—è–µ–º –Ω—É–∂–Ω—ã–º–∏ –ø–∞–ø–∫–∞–º–∏)
root/
 ‚îú‚îÄ backend/
 ‚îÇ   ‚îú‚îÄ src/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ models/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ routes/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ controllers/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ services/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ middlewares/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ utils/
 ‚îÇ   ‚îÇ   ‚îú‚îÄ config/
 ‚îÇ   ‚îÇ   ‚îî‚îÄ app.js
 ‚îú‚îÄ bot/
 ‚îÇ   ‚îú‚îÄ index.js
 ‚îÇ   ‚îî‚îÄ modules/
 ‚îú‚îÄ miniapp/
 ‚îÇ   ‚îú‚îÄ src/
 ‚îÇ   ‚îî‚îÄ vite.config.js
 ‚îú‚îÄ web/
 ‚îÇ   ‚îú‚îÄ src/
 ‚îÇ   ‚îî‚îÄ vite.config.js
 ‚îú‚îÄ shared/
 ‚îÇ   ‚îú‚îÄ types/
 ‚îÇ   ‚îú‚îÄ constants/
 ‚îÇ   ‚îî‚îÄ utils/
 ‚îî‚îÄ README.md

üß© 2. Backend –º–æ–¥–µ–ª–∏ (—É—á–∏—Ç—ã–≤–∞—é—Ç –Ω–∞—à —Å—Ç–∞—Ä—ã–π –∫–æ–¥ + –Ω–æ–≤—ã–µ —Ñ–∏—á–∏)
‚úî City (–∫–∞–∫ —É –Ω–∞—Å –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å)
City {
  code: string;
  name: string;
  theme: {
    primaryColor: string;
    logoUrl: string;
  };
  features: {
    enableFarmers: boolean;
    enableCrafts: boolean;
    enableTaxi: boolean;
  };
}

‚úî CityLayout (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–µ–∑–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤)
CityLayout {
  cityCode: string;
  screen: string;
  variant?: string; // A/B
  seasonCode?: string; // –Ω–∞–ø—Ä–∏–º–µ—Ä: march8_tulips
  blocks: [
    {
      type: string;
      slotId?: string;
      title?: string;
      subtitle?: string;
      source?: string;
      categoryIds?: string[];
      limit?: number;
      layout?: string; // horizontal/vertical/grid
    }
  ];
}

‚úî ContentSlot
ContentSlot {
  slotId: string;
  data: {
    title?: string;
    subtitle?: string;
    imageUrl?: string;
    link?: string;
  };
}

‚úî Ad (—Å GeoJSON –∏ seasonCode)
Ad {
  title: string;
  description: string;
  price: number;
  categoryId: string;
  subcategoryId: string;
  cityCode: string;

  seasonCode?: string;

  geo: {
    type: "Point",
    coordinates: [lng, lat];
  };

  createdAt: Date;
  views: number;
}


–î–æ–±–∞–≤—å 2dsphere –∏–Ω–¥–µ–∫—Å:

AdSchema.index({ geo: "2dsphere" });

üì° 3. Backend –º–∞—Ä—à—Ä—É—Ç—ã (–¥–æ–ø–∏—Å–∞—Ç—å)
‚úî /api/layout?cityCode=&screen=home&variant=A

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫–∏ —ç–∫—Ä–∞–Ω–æ–≤.

‚úî /api/content/slot/:slotId

–ë–∞–Ω–Ω–µ—Ä—ã –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏.

‚úî /api/ads/nearby?lat=&lng=&radiusKm=&categoryId=

–ì–µ–æ–ø–æ–∏—Å–∫.

‚úî /api/ads/trending?cityCode=

–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤ –≥–æ—Ä–æ–¥–µ.

‚úî /api/ads?seasonCode=march8_tulips

–°–µ–∑–æ–Ω–Ω—ã–µ –ø–æ–¥–±–æ—Ä–∫–∏.

‚úî /api/user/initData

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è MiniApp (–ø–æ–¥–ø–∏—Å—å initDataUnsafe).

üí¨ 4. Telegram Bot (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)

–í –±–æ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å:

—Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏:

–û—Ç–∫—Ä—ã—Ç—å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å

–§–µ—Ä–º–µ—Ä—Å–∫–∏–π —Ä—ã–Ω–æ–∫

–†–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫–∏

–Ø—Ä–º–∞—Ä–∫–∞ 8 –º–∞—Ä—Ç–∞

–∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç MiniApp —á–µ—Ä–µ–∑ web_app

–î–æ–±–∞–≤–∏—Ç—å deep-links:

https://t.me/YourBot?startapp=season_march8

üì± 5. MiniApp (React + Telegram WebApp API)

–§—Ä–æ–Ω—Ç –¥–µ–ª–∞–µ—Ç:

const initData = Telegram.WebApp.initDataUnsafe;
const cityCode = resolveCity(initData);
const layout = await api.getLayout(cityCode, "home");


–°—Ç—Ä–∞–Ω–∏—Ü–∞ Home:

<RenderBlocks blocks={layout.blocks} />

üß† 6. Server-Driven UI ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

–í miniapp –∏ web —Å–æ–∑–¥–∞—ë–º:

src/layout/RenderBlocks.jsx


–° –º–∞–ø–ø–µ—Ä–æ–º:

switch(block.type) {
  case "hero_banner":
  case "category_grid":
  case "ad_list":
  case "promo_banner":
  case "map_block":
}

üß≤ 7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≥–æ—Ä–æ–¥

–ø–æ initData (–µ—Å–ª–∏ –≤ –±–æ—Ç–µ –≤—ã–±—Ä–∞–Ω –≥–æ—Ä–æ–¥)

–ø–æ –ø–æ–∏—Å–∫—É IP / domain

–ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

fallback: brest

üî• 8. –£—á–µ—Å—Ç—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

–ù—É–∂–Ω–æ:

–ù–ï –ü–ï–†–ï–ü–ò–°–´–í–ê–¢–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã

–î–û–ü–û–õ–ù–ò–¢–¨ –ø—Ä–æ–µ–∫—Ç –Ω–æ–≤—ã–º–∏ –º–æ–¥—É–ª—è–º–∏

–¥–µ–ª–∞—Ç—å –≤—Å—ë —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å –Ω–∞—à–∏–º —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º

üõ† 9. –ö–æ–Ω–µ—á–Ω–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–º—Ç–∞ –Ω–∞ –≤—ã—Ö–æ–¥–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π backend

—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π bot

miniapp, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –≥—Ä—É–∑–∏—Ç layout

web-–≤–µ—Ä—Å–∏—è —Å —Ç–µ–º–∏ –∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

–º–æ–¥–µ–ª–∏ City, CityLayout, ContentSlot, Ad

–º–∞—Ä—à—Ä—É—Ç—ã API

–±–ª–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º

—Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ä–æ–¥–æ–≤

—Å–µ–∑–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

üìå –í –∫–æ–Ω—Ü–µ:

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π:

–≤—Å–µ —Ñ–∞–π–ª—ã

–ø–æ–ª–Ω—ã–π –∫–æ–¥

–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞

–ø—Ä–∏–º–µ—Ä—ã layout‚Äô–æ–≤ –¥–ª—è –ë—Ä–µ—Å—Ç–∞, –ú–∏–Ω—Å–∫–∞ –∏ –ì—Ä–æ–¥–Ω–æ