–®–∞–≥ 5. –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ bot.on("text") –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

–†–∞–Ω—å—à–µ –º—ã –¥–µ–ª–∞–ª–∏ ctx.session.sellDraft. –°–µ–π—á–∞—Å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º ctx.session.sell.
–ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π bot.on("text", ...) –Ω–∞ –Ω–æ–≤—ã–π.

–ù–∞–π–¥–∏ –≤ bot/bot.js –±–ª–æ–∫ –≤–∏–¥–∞:

bot.on("text", async (ctx) => {
  // ...
});


–∏ –∑–∞–º–µ–Ω–∏ –Ω–∞ —Ç–∞–∫–æ–π:

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ /sell
  bot.on("text", async (ctx) => {
    if (!ctx.session || !ctx.session.sell) {
      // –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º, –ø—É—Å—Ç—å –¥—Ä—É–≥–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã —Å—Ä–∞–±–æ—Ç–∞—é—Ç
      return;
    }

    const sell = ctx.session.sell;
    const text = ctx.message.text.trim();

    // –®–∞–≥: –∑–∞–≥–æ–ª–æ–≤–æ–∫
    if (sell.step === "title") {
      sell.data.title = text;
      sell.step = "description";

      await ctx.reply(
        "üìù –®–∞–≥ 4/5 ‚Äî –≤–≤–µ–¥–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.\n" +
        "–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–î–æ–º–∞—à–Ω—è—è –º–∞–ª–∏–Ω–∞, —Å–æ–±–∏—Ä–∞—é –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ, –±–µ–∑ —Ö–∏–º–∏–∏¬ª."
      );
      return;
    }

    // –®–∞–≥: –æ–ø–∏—Å–∞–Ω–∏–µ
    if (sell.step === "description") {
      sell.data.description = text;
      sell.step = "price";

      await ctx.reply(
        "üí∞ –®–∞–≥ 5/5 ‚Äî –≤–≤–µ–¥–∏ —Ü–µ–Ω—É (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ).\n" +
        "–ù–∞–ø—Ä–∏–º–µ—Ä: 10"
      );
      return;
    }

    // –®–∞–≥: —Ü–µ–Ω–∞
    if (sell.step === "price") {
      const priceNumber = Number(text.replace(",", "."));
      if (Number.isNaN(priceNumber) || priceNumber <= 0) {
        await ctx.reply("–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, –Ω–∞–ø—Ä–∏–º–µ—Ä: 10");
        return;
      }

      sell.data.price = priceNumber;

      // —Ñ–æ—Ä–º–∏—Ä—É–µ–º payload
      const payload = {
        title: sell.data.title,
        description: sell.data.description,
        categoryId: sell.data.categoryId,
        subcategoryId: sell.data.subcategoryId,
        price: sell.data.price,
        currency: "BYN",
        attributes: {},
        photos: [],
        sellerTelegramId: ctx.from.id,
        deliveryType: "pickup_only",
        deliveryRadiusKm: null,
        location: null,
        seasonCode: null,
        lifetimeDays: 7,
      };

      try {
        const API_BASE_URL = process.env.API_BASE_URL || "http://localhost:3000";
        const res = await axios.post(`${API_BASE_URL}/api/ads`, payload);
        const ad = res.data;

        // –æ—á–∏—â–∞–µ–º –º–∞—Å—Ç–µ—Ä
        ctx.session.sell = null;

        await ctx.reply(
          "‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!\n\n" +
          `–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${ad.title}\n` +
          `–¶–µ–Ω–∞: ${ad.price} ${ad.currency || "BYN"}\n\n` +
          "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è: /my_ads"
        );
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ /sell:", err.response?.data || err.message);
        ctx.session.sell = null;
        await ctx.reply("‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.");
      }

      return;
    }
  });