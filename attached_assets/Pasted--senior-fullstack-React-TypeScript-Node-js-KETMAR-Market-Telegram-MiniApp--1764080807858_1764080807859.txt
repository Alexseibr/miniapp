Ты — senior fullstack (React + TypeScript + Node.js) в проекте KETMAR Market (Telegram MiniApp).

Нужно доработать ШАГ «Фото товара» в мастере подачи объявления и всю логику переходов по шагам до публикации.

Сейчас проблемы:

1) На шаге «Фото товара»:
   - можно только сделать фото с камеры,
   - НЕТ варианта выбрать фото из галереи (памяти устройства),
   - при попытке загрузить иногда появляется ошибка «Ошибка получения URL загрузки» и всё ломается.

2) Если пользователь НЕ хочет добавлять фото:
   - нет кнопки «Далее / Пропустить»,
   - нельзя перейти к следующему шагу и завершить подачу объявления без фото.

3) Нужно убедиться, что мастер:
   - может пройти все шаги **без фото**,
   - корректно доходит до финального шага (публикация),
   - и опционально позволяет указать время, когда объявление должно быть опубликовано (отложенная публикация).

СДЕЛАЙ ВСЁ НИЖЕ, НЕ ЛОМАЯ СУЩЕСТВУЮЩУЮ АРХИТЕКТУРУ.

=================================================
1. ШАГ «ФОТО ТОВАРА» — UI И ПОВЕДЕНИЕ
=================================================

Найди компонент шага «Фото товара» в мастере:
- например: `AdCreatePhotosStep`, `PhotosStep`, `CreateAdPhotosScreen` и т.п.

Сейчас там 4 слота (плейсхолдера) «Добавить» и сообщение об ошибке.

Надо:

1.1. Поддержка двух вариантов добавления фото
---------------------------------------------

ПОВЕДЕНИЕ ПРИ ТАПЕ НА ЛЮБОЙ СЛОТ:

- Открывать простое диалоговое меню (ActionSheet / попап) с двумя вариантами:

  1) «Сделать фото»
  2) «Выбрать из галереи»

- Вариант «Сделать фото»:
  - использовать `<input type="file" accept="image/*" capture="environment" />`
  - или WebApp API, если проект его уже оборачивает.
- Вариант «Выбрать из галереи»:
  - использовать `<input type="file" accept="image/*" />` **БЕЗ** `capture`,
  - чтобы открывалась галерея/файлы.

Требования:

- Макс. 4 фото.
- При выборе нескольких файлов — ограничивать до 4, лишние игнорировать.
- Каждое фото сохраняется в локальный state шага:
  - массив `files: File[]` или массив объектов `{ file, previewUrl }`.

1.2. Превью и управление фото
-----------------------------

- В каждом слоте:
  - если фото нет — показывать placeholder (иконка камеры + «Добавить»),
  - если фото уже есть — показывать превью (обрезанное аккуратно по размеру),
  - добавить иконку крестика для удаления фото из слота.

- Поддержать reorder не обязательно, достаточно простого порядка «как выбрали».

1.3. Обработка ошибки «Ошибка получения URL загрузки»
-----------------------------------------------------

Похоже, что сейчас логика такая:
- при добавлении фото запрашивается upload URL с backend,
- если что-то падает — показывается красная плашка «Ошибка получения URL загрузки».

Нужно:

- Обернуть запрос upload URL в try/catch.
- Если upload URL не удалось получить:
  - НЕ ломать весь шаг,
  - показать понятное сообщение + кнопку «Повторить попытку».
  - НЕ запрещать пользователю идти дальше **без этих фото**.

Поведение:

- Ошибка получения URL — это **локальная проблема с загрузкой**, а НЕ блокировка мастера.
- Если ни одно фото не было успешно подготовлено к загрузке — при переходе дальше просто отправляем объявление без фото.

==========================================
2. КНОПКА «ДАЛЕЕ / ПРОПУСТИТЬ» БЕЗ ФОТО
==========================================

На шаге «Фото товара» нужно явно позволить пользователю продолжить без фотографий.

Сделать:

- Внизу экрана:
  - основная большая кнопка:
    - текст: `"Продолжить"` или `"Далее"`
  - под ней (опционально) маленькая текстовая ссылка:
    - `"Пропустить и продолжить без фото"` (если хочешь развести сенс).

Логика:

1) Если в state есть хотя бы одно выбранное фото:
   - при нажатии «Продолжить»:
     - выполняем загрузку / подготовку фото (если нужно),
     - сохраняем ссылки / файлы в общем состоянии мастера объявления,
     - переходим на следующий шаг.

2) Если фото НЕТ (массив пустой):
   - при нажатии «Продолжить»:
     - просто сохраняем, что у объявления нет фото,
     - переходим на следующий шаг **без ошибок**.

Никаких обязательных фото. Шаг должен быть **опциональным**.

Важно:

- Убедиться, что ВАЛИДАЦИЯ мастера НЕ требует фото.
- Если где-то в коде стоит правило «нужно минимум 1 фото» — убрать/отключить.

================================================
3. ПРОХОД ПО ВСЕМ ШАГАМ ДО ПУБЛИКАЦИИ
================================================

Найти корневой компонент мастера подачи объявления:
- `CreateAdWizard`, `AdCreateFlow`, `SubmitAdStepper` и т.п.

Там должен быть state вида:
- `currentStep`,
- структуры с данными объявления (location, photos, title, price, contacts и т.д.).

Нужно:

3.1. Проверить, что каждый шаг может быть пройден:
--------------------------------------------------

1) Геолокация:
   - уже исправлено: после определения местоположения — авто-переход на следующий шаг.
   - также должна быть возможность выбрать гео вручную (если сделано).

2) Фото:
   - после изменений из этого промта — можно пройти и с фото, и без фото.

3) Основная информация (название, цена, категория, контакты):
   - должны быть свои проверки, но фото здесь уже **не участвует**.

4) Финальный шаг — публикация:
   - отправка данных на backend:
     - location + geoLabel,
     - данные объявления (title, description, category, price, контакты),
     - список фото (может быть пустым),
     - опционально — `publishAt` (отложенная публикация).

3.2. Добавить опциональное поле «Время публикации» (если это предусмотрено)
---------------------------------------------------------------------------

На финальном шаге (после ввода всех данных) добавить блок:

- Заголовок:
  - `"Когда опубликовать объявление?"`
- Переключатель:
  - `[•] Опубликовать сейчас`
  - `[ ] Запланировать на позже`
- Если выбран вариант «Запланировать» — показать date/time picker:
  - дата + время (локальное),
  - сохраняем в state `publishAt: Date | null`.

На backend:

- В запрос `POST /api/ads` добавить поле:
  - `publishAt` (ISO-строка или timestamp).
- Если `publishAt` не задано — считать, что объявление публикуется сразу.
- Если задано — сохранять его в модели `Ad` и размечать объявление как «отложенное» (детальная реализация публикации по расписанию может быть сделана позже; сейчас важно не падать от наличия поля).

================================================
4. BACKEND: ЗАГРУЗКА ФОТО И ОПЦИОНАЛЬНОСТЬ
================================================

Проверь/исправь backend-часть, которая отвечает за загрузку фото:

- Эндпоинты:
  - получение upload URL,
  - приём загруженных фото,
  - финальный `POST /api/ads`.

Требования:

1) Все операции с фото должны быть **опциональными**:
   - если массив файлов пустой — не пытаться получать upload URL,
   - не считать ошибкой отсутствие фото.

2) На финальном `POST /api/ads`:
   - `photos` может быть пустым массивом или не передаваться,
   - backend не должен возвращать 400/422 из-за отсутствия фото.

3) Сообщение «Ошибка получения URL загрузки»:
   - возвращать только при реальной ошибке запроса,
   - оно не должно блокировать остальные шаги.

================================================
5. КОДОВОЙ РЕЗЮМЕ: ЧТО НУЖНО СДЕЛАТЬ
================================================

ФРОНТ:

1) В компоненте шага «Фото товара»:
   - добавить два варианта добавления фото:
     - «Сделать фото» (камера),
     - «Выбрать из галереи» (файлы устройства).
   - показывать превью,
   - позволять удалять фото,
   - ограничить до 4 фото.

2) Обработать ошибки получения upload URL:
   - не блокировать мастера,
   - дать возможность повторной попытки и/или пройти шаг без фото.

3) Добавить кнопку «Продолжить» (и, при желании, «Пропустить»):
   - позволить двигаться дальше с 0 фото.

4) Проверить и, при необходимости, поправить блокировку валидации:
   - мастер должен доходить до финала без фото.

5) На финальном шаге:
   - добавить опциональное поле «Время публикации» (переключатель сейчас / позже + дата/время),
   - сохранить `publishAt` в общем state и отправить на backend.

БЭКЕНД:

6) Убедиться, что:
   - upload URL не обязателен, если нет фото,
   - объявление без фото создаётся без ошибок,
   - принимается и сохраняется `publishAt` (можно пока просто хранить его в модели `Ad`).

================================================
6. В КОНЦЕ — ОТЧЁТ
================================================

По завершению:

- Выведи список изменённых/созданных файлов с кратким описанием:
  - `AdCreatePhotosStep.tsx` — добавлены варианты камеры/галереи, превью и кнопка «Продолжить без фото».
  - `CreateAdWizard.tsx` — проверено/обновлено прохождение всех шагов, добавлен `publishAt`.
  - `ads.controller.ts` / `Ad.model.ts` — добавлено поле `publishAt`, фото сделаны опциональными.
- Предложи ветку и коммит:
  - ветка: `fix/ad-create-photos-optional`
  - коммит: `fix(ad-create): allow camera/gallery photos and continue without images + optional scheduled publish`
