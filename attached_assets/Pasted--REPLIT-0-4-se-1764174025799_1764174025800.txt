ПРОМТ ДЛЯ REPLIT: ШАГ «ФОТО ТОВАРА» — СДЕЛАТЬ ОПЦИОНАЛЬНЫМ (0–4 ФОТО) + ПОДСКАЗКА ПРО ЛЕНТУ

Ты — senior full-stack разработчик (React + Node.js + MongoDB).
Нужно починить шаг “Фото товара” в мастере подачи объявления:

сейчас нельзя перейти дальше ни без фото, ни с 1–4 фото;

по дизайну сверху написано: «До 4 фотографий (необязательно)», но по факту шаг ведёт себя как обязательный.

1. Текущее поведение (БАГ)

Сценарий:

Открываю: «Мои» → «Добавить объявление».

Прохожу шаг «Где вы продаёте?» → попадаю на шаг «Фото товара» (экран как на скриншотах).

Варианты:

0 фотографий — хочу пропустить и пойти дальше.

1–4 фотографий — загружаю картинки, они отображаются в квадратиках (первое как «Главное»).

В обоих случаях:

нет возможности перейти к следующему шагу (название, описание, цена),

кнопка «Далее» либо отсутствует, либо неактивна/не срабатывает.

Это нужно исправить.

2. Что нужно сделать по шагу «Фото товара»
2.1. Сделать шаг реально необязательным

Требования:

Пользователь должен иметь возможность:

0 фото → нажать «Далее» и перейти к следующему шагу.

1 фото → «Далее».

2, 3, 4 фото → «Далее».

Не должно быть жёсткой проверки images.length >= 1 ни на фронте, ни на бэке на этом шаге мастера.

То есть:

валидация этого шага не должна блокировать переход, если:

нет технических ошибок загрузки,

нет превышения лимита (больше 4).

2.2. Исправить валидацию на фронте

Найди компонент шага «Фото товара» (что-то вроде AdPhotosStep, CreateAdPhotosStep, PhotosStep).

Проверь:

функции типа canGoNext, validateStep, isValid,

обработчик кнопки Next / Далее.

Сейчас, скорее всего, где-то есть логика:

if (!photos || photos.length === 0) {
  // блокируем переход
}


Нужно:

убрать обязательность минимум одной фотки,

оставить только проверки:

photos.length <= 4,

корректность формата/размера,

отсутствие ошибок загрузки.

В итоге:

const canGoNext = !isUploading && !hasUploadErrors;


А количество фото (0–4) не должно влиять на возможность перейти дальше.

2.3. Проверить backend-валидацию

Проверь модель Ad и endpoint создания/обновления объявления.

В Ad (Mongoose/Schema):

поле images не должно быть required,

не должно стоять правило min: 1 или кастомный валидатор images.length >= 1.

В контроллере createAd / updateAd:

не должно быть проверок, которые кидают ошибку, если images.length === 0.

Если такие проверки есть — убери их или приведи к логике:

images опциональны,

но если есть — максимум 4, корректные URL.

3. Подсказка: объявления без фото не попадут в Ленту

По бизнес-логике:

Объявления без фотографий:

можно создавать и публиковать,

но они НЕ должны попадать в TikTok-/Инста-Ленту,

остаются доступны в поиске, категориях, списках «Мои объявления» и т.п.

Нужно:

3.1. Текстовая подсказка на шаге «Фото товара»

Под блоком с квадратиками (там, где уже есть синий блок с текстом), добавь дополнительную строку мелким шрифтом:

Например:

ℹ️ Объявления без фотографий не показываются в ленте, но будут доступны в поиске и категориях.

Требования:

текст спокойный, не блокирующий,

без модалок/алертов — просто информируем,

шаг всё равно можно пройти без фото.

3.2. Гарантировать, что в Ленту попадают только объявления с фото

Убедись, что код Ленты уже фильтрует объявления без фото (если нет — добавь фильтрацию):

Фронт (FeedScreen):

const feedItems = rawItems.filter(ad => ad.images && ad.images.length > 0);


Backend (/api/feed, если удобно):

{ images: { $exists: true, $ne: [] } }


Это нужно только подтвердить/поддержать: в Ленте показываем только объявления с хотя бы одной фотографией.

4. Переход к следующему шагу и сохранение фотографий

Проверь, что:

При нажатии «Далее» на шаге «Фото товара»:

выбранные фото (если есть) складываются в draftAd.images (или аналогичное поле),

устанавливается флаг «главное фото» (если есть такая логика),

вызывается goToNextStep() и мы попадаем на шаг название/описание/цена.

При возвращении назад на шаг «Фото товара»:

уже добавленные фото отображаются корректно,

их можно удалить, поменять главное и снова идти дальше.

С 0, 1, 2, 3, 4 фото — мастер работает одинаково корректно, ничего не зависает.

5. Регресс-проверка (ручные сценарии)

После правок сам проверь:

0 фото:

шаг «Фото товара» → ничего не загружаю → жму «Далее» → попадаю на шаг названия/описания,

объявление создаётся и сохраняется,

в Ленте это объявление не появляется.

1 фото:

загружаю 1 фото → жму «Далее» → иду дальше → публикую,

объявление появляется:

в «Мои объявления»,

в поиске/категории,

в Ленте.

4 фото:

загружаю 4 разных фото → далее → публикую,

главное фото корректно используется как основное,

остальные доступны в детальном просмотре объявления.

Сценарий из вкладки «Мои» → «Добавить объявление»:

весь мастер (местоположение → фото → название/описание/цена → контакты → публикация) работает без зависаний и ошибок.

6. Осторожность

Не меняй лишний UI/логики мастера:
только шаг «Фото товара» и связанные с ним проверки.

Не ломай текущую интеграцию загрузки файлов (input, upload-endpoint, хранилище).

Лента, поиск, категории и остальные экраны должны продолжить работать как раньше, только с учётом того, что часть объявлений может быть без фото.

Сделай, пожалуйста, чтобы шаг «Фото товара» стал реально опциональным (0–4 фото), с понятной подсказкой, и чтобы пользователь всегда мог пройти к следующему шагу и разместить объявление.