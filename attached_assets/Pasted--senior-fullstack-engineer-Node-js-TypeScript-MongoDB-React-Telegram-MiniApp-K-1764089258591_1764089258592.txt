–¢—ã ‚Äî senior fullstack engineer (Node.js + TypeScript + MongoDB + React/Telegram MiniApp) –≤ –ø—Ä–æ–µ–∫—Ç–µ KETMAR Market.

–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ‚Äú—É–º–Ω—ã–π –¥–≤–∏–∂–æ–∫ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞‚Äù, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç:

1) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (Apple, Samsung, Xiaomi, LG, Bosch –∏ —Ç.–¥.)
2) –ê–≤—Ç–æ-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∞–≤—Ç–æ (–º–∞—Ä–∫–∞ ‚Üí –º–æ–¥–µ–ª—å)
3) –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã (–≤—Å–ø–ª–µ—Å–∫–∏ —Å–ø—Ä–æ—Å–∞/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
4) –ì–æ—Ä—è—á–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—á—Ç–æ –ª—é–¥–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –∏—â—É—Ç —Ä—è–¥–æ–º)

–í—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ, –Ω–∞ –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

========================================
0. –ë–ê–ó–û–í–´–ô –ö–û–ù–¢–ï–ö–°–¢
========================================

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- Backend: Node.js + TypeScript + Express/Nest-like –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- DB: MongoDB (Mongoose)
- Front: React + TypeScript (Telegram MiniApp / web)

–£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å:
- –ú–æ–¥–µ–ª—å Category (–¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- –ú–æ–¥–µ–ª—å Ad (–æ–±—ä—è–≤–ª–µ–Ω–∏—è)
- –ú–æ–¥–µ–ª—å User
- –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º

–ù—É–∂–Ω–æ –≤—Å—ë –¥–æ–ø–∏–ª–∏—Ç—å –∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å.

========================================
1. –£–ú–ù–´–ï –ë–†–ï–ù–î-–ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ò (Apple, Samsung, Xiaomi, LG...)
========================================

–¶–µ–ª—å:
- –í–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–∏–ø–∞ ‚Äú–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞‚Äù, ‚Äú–¢–µ—Ö–Ω–∏–∫–∞‚Äù, ‚Äú–¢–µ–ª–µ—Ñ–æ–Ω—ã‚Äù –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å/–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –±—Ä–µ–Ω–¥–∞–º.
- –ü—Ä–∏–º–µ—Ä—ã:
  - –¢–µ–ª–µ—Ñ–æ–Ω—ã ‚Üí Apple / Samsung / Xiaomi / Realme / Huawei
  - –¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã ‚Üí LG / Samsung / Sony / Hisense
  - –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏ ‚Üí Bosch / LG / Samsung

1.1. –ú–æ–¥–µ–ª—å BrandStats

–°–æ–∑–¥–∞–π –∫–æ–ª–ª–µ–∫—Ü–∏—é `BrandStats`:

```ts
interface BrandStats {
  _id: ObjectId;
  brand: string;             // 'apple', 'samsung', 'lg'
  normalizedBrand: string;   // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ (lowercase)
  categoryId: ObjectId;      // –∫ –∫–∞–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "—Ç–µ–ª–µ—Ñ–æ–Ω—ã")
  totalCount: number;        // –≤—Å–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —Å—Ç—Ä–∞–Ω–µ
  localCounts?: {
    geoHash: string;         // –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–∞–π–æ–Ω—É/–≥–æ—Ä–æ–¥—É
    count: number;
  }[];
  lastUpdatedAt: Date;
}
–ò–Ω–¥–µ–∫—Å—ã:

{ categoryId: 1, normalizedBrand: 1 }

{ normalizedBrand: 1 }

1.2. –°–ª–æ–≤–∞—Ä—å –±—Ä–µ–Ω–¥–æ–≤

–°–æ–∑–¥–∞–π brands.config.ts:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
export const BRAND_KEYWORDS: Record<string, string[]> = {
  apple: ['apple', 'iphone', 'ipad', 'macbook', 'airpods'],
  samsung: ['samsung', 'galaxy'],
  xiaomi: ['xiaomi', 'redmi', 'mi'],
  lg: ['lg'],
  bosch: ['bosch'],
  sony: ['sony', 'playstation'],
  // ...
};
1.3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Ad:

—Å–æ–±—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç: title + description

–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å (lowercase, —É–±—Ä–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)

–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ BRAND_KEYWORDS

–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –±—Ä–µ–Ω–¥:

—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ ad.brand (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'apple')

–æ–±–Ω–æ–≤–∏—Ç—å BrandStats:

totalCount += 1

–Ω–∞–π—Ç–∏/–æ–±–Ω–æ–≤–∏—Ç—å localCounts –ø–æ geoHash (–∏–ª–∏ cityId)

1.4. –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

–†–∞—Å—à–∏—Ä—å Category:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
interface Category {
  // ...
  parentId?: ObjectId | null;
  isBrandCategory?: boolean;   // —ç—Ç–æ –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
  brandKey?: string | null;    // 'apple', 'samsung'
  isDynamic?: boolean;         // —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
}
CRON/worker (—Ä–∞–∑ –≤ —Å—É—Ç–∫–∏):

–¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–µ–ª–µ—Ñ–æ–Ω—ã, —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã, —Ç–µ—Ö–Ω–∏–∫–∞):

–ø–æ—Å—á–∏—Ç–∞—Ç—å BrandStats.totalCount –ø–æ –±—Ä–µ–Ω–¥—É

–µ—Å–ª–∏ totalCount >= 10 –∏ –Ω–µ—Ç –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

—Å–æ–∑–¥–∞—Ç—å Category —Å isBrandCategory = true, brandKey = 'apple', isDynamic = true

–µ—Å–ª–∏ totalCount < 3 –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è isDynamic = true:

–º–æ–∂–Ω–æ –µ—ë —Å–∫—Ä—ã—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (isActive = false), –Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Å brand-—Ñ–∏–ª—å—Ç—Ä–æ–º.

1.5. –í–∏–¥–∏–º–æ—Å—Ç—å –±—Ä–µ–Ω–¥–∞ –≤ –ª–æ–∫–∞—Ü–∏–∏

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

GET /api/categories/brands?categoryId=&lat=&lng=&radiusKm=

–ø–æ brandStats.localCounts –¥–ª—è –±–ª–∏–∂–∞–π—à–µ–≥–æ geoHash

–µ—Å–ª–∏ count >= 3 ‚Üí –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤–∏–¥–∏–º–∞

–µ—Å–ª–∏ count < 3 ‚Üí —Å–∫—Ä—ã—Ç–∞ (–Ω–æ –±—Ä–µ–Ω–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —Å—Ç—Ä–∞–Ω–µ).

Front:

–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–¢–µ–ª–µ—Ñ–æ–Ω—ã" –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–ª–æ–∫:

–ë—Ä–µ–Ω–¥—ã: Apple, Samsung, Xiaomi‚Ä¶

–ø—Ä–∏ –≤—ã–±–æ—Ä–µ –±—Ä–µ–Ω–¥–∞:

–ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∫ –ª–µ–Ω—Ç–µ (ad.brand = brandKey).

========================================
2. –£–ú–ù–´–ï –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ò –î–õ–Ø –ê–í–¢–û (–ú–ê–†–ö–ê ‚Üí –ú–û–î–ï–õ–¨)
–¶–µ–ª—å:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å:

–ê–≤—Ç–æ ‚Üí –õ–µ–≥–∫–æ–≤—ã–µ ‚Üí Audi / BMW / VW / Toyota / Mercedes...

–≤–Ω—É—Ç—Ä–∏ –º–∞—Ä–∫–∏ ‚Üí –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä Audi ‚Üí A4, A6, Q5.

2.1. –ú–æ–¥–µ–ª–∏ AutoBrandStats / AutoModelStats

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
interface AutoBrandStats {
  _id: ObjectId;
  brand: string;          // 'audi'
  totalCount: number;
  lastUpdatedAt: Date;
}

interface AutoModelStats {
  _id: ObjectId;
  brand: string;          // 'audi'
  model: string;          // 'a4', 'q5'
  totalCount: number;
  lastUpdatedAt: Date;
}
2.2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–∞—Ä–∫–∏/–º–æ–¥–µ–ª–∏

–°–æ–∑–¥–∞–π auto.config.ts:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
export const AUTO_BRANDS = ['audi','bmw','mercedes','toyota','vw','volkswagen','lada', ...];

export const AUTO_MODELS: Record<string, string[]> = {
  audi: ['a3','a4','a6','q3','q5','q7'],
  bmw: ['x5','x3','5','3','7'],
  toyota: ['camry','corolla','rav4'],
  // ...
};
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞–≤—Ç–æ-–æ–±—ä—è–≤–ª–µ–Ω–∏—è:

–ø–∞—Ä—Å–∏–º brand:

–ø–æ title/description: –∏—â–µ–º —Å–ª–æ–≤–∞ –∏–∑ AUTO_BRANDS (–≤–∫–ª—é—á–∞—è –∞–ª–∏–∞—Å—ã: 'vw' ‚Üí 'volkswagen')

–ø–∞—Ä—Å–∏–º model:

–µ—Å–ª–∏ –ø–æ—Å–ª–µ –±—Ä–µ–Ω–¥–∞ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è A4, A6, X5 –∏ —Ç.–ø.

–∏–ª–∏ –∏—â–µ–º —Å–ª–æ–≤–∞ –∏–∑ AUTO_MODELS[brand]

–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Ad:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
ad.autoBrand = 'audi';
ad.autoModel = 'a4';
–û–±–Ω–æ–≤–ª—è–µ–º AutoBrandStats –∏ AutoModelStats.

2.3. –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–æ–∫ –∏ –º–æ–¥–µ–ª–µ–π –∫–∞–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

–†–∞—Å—à–∏—Ä—å Category –¥–ª—è –∞–≤—Ç–æ:

–î–ª—è root –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ê–≤—Ç–æ":

—Å–æ–∑–¥–∞—ë–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

"–õ–µ–≥–∫–æ–≤—ã–µ"

"–ì—Ä—É–∑–æ–≤—ã–µ"

"–°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞"

–∏ —Ç.–ø.

–î–∞–ª–µ–µ:

–ï—Å–ª–∏ AutoBrandStats.totalCount(brand) >= 10:

—Å–æ–∑–¥–∞—ë–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –±—Ä–µ–Ω–¥–∞:

–ê–≤—Ç–æ ‚Üí –õ–µ–≥–∫–æ–≤—ã–µ ‚Üí Audi (isDynamic = true, brandKey='audi')

–ï—Å–ª–∏ AutoModelStats.totalCount(brand, model) >= 7:

—Å–æ–∑–¥–∞—ë–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –º–æ–¥–µ–ª–∏:

–ê–≤—Ç–æ ‚Üí –õ–µ–≥–∫–æ–≤—ã–µ ‚Üí Audi ‚Üí A4 (isDynamic = true, brandKey='audi', modelKey='a4')

–°–∫—Ä—ã—Ç–∏–µ:

–µ—Å–ª–∏ totalCount(brand) < 3 ‚Üí –±—Ä–µ–Ω–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å (isActive = false)

–µ—Å–ª–∏ totalCount(model) < 2 ‚Üí –º–æ–¥–µ–ª—å-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–∫—Ä—ã—Ç—å.

Front:

–§–∏–ª—å—Ç—Ä—ã:

–ú–∞—Ä–∫–∞ (select: Audi, BMW, VW, ...)

–ú–æ–¥–µ–ª—å (select ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±—Ä–µ–Ω–¥–∞)

–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ-–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –ø–æ–¥–∞—á–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –±—Ä–µ–Ω–¥/–º–æ–¥–µ–ª—å).

========================================
3. –õ–û–ö–ê–õ–¨–ù–´–ï –¢–†–ï–ù–î–´ (–°–ü–†–û–° / –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï)
–¶–µ–ª—å:

–ü–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ ‚Äú—Å–µ–π—á–∞—Å —Å–∏–ª—å–Ω–æ —Ä–∞—Å—Ç—ë—Ç‚Äù –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä—è–¥–æ–º —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

–ü—Ä–∏–º–µ—Ä—ã:

‚Äú–°–ø—Ä–æ—Å –Ω–∞ –∫–∞—Ä—Ç–æ—à–∫—É –≤—ã—Ä–æ—Å –Ω–∞ +48% –∑–∞ –Ω–µ–¥–µ–ª—é‚Äù

‚Äú–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –∫–ª—É–±–Ω–∏–∫–µ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å –Ω–∞ 30%‚Äù

‚Äú–ê–≤—Ç–æ ‚Üí –õ–µ–≥–∫–æ–≤—ã–µ –≤ –ë—Ä–µ—Å—Ç–µ –≤—ã—Ä–æ—Å–ª–∏ –Ω–∞ 20% –∑–∞ 3 –¥–Ω—è‚Äù

3.1. –ú–æ–¥–µ–ª—å TrendEvent

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
interface TrendEvent {
  _id: ObjectId;
  categoryId: ObjectId;       // —Ñ–µ—Ä–º–µ—Ä—Å–∫–∞—è/–ª—é–±–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  metric: 'views' | 'ads';    // —á—Ç–æ —Ä–∞—Å—Ç—ë—Ç ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
  locationGeoHash: string;    // —Ä–∞–π–æ–Ω/–≥–æ—Ä–æ–¥
  deltaPercent: number;       // +50%, -20% (–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ)
  period: 'day' | 'week';
  createdAt: Date;
}
3.2. –†–∞—Å—á—ë—Ç —Ç—Ä–µ–Ω–¥–æ–≤

–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞–ø—É—Å–∫–∞–µ–º worker:

–¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –≥–µ–æ-—Ä–∞–π–æ–Ω–∞ (geoHash):

—Å—á–∏—Ç–∞–µ–º:

viewsToday, viewsYesterday

adsToday, adsYesterday

–≤—ã—á–∏—Å–ª—è–µ–º:

deltaViews = (viewsToday - viewsYesterday) / max(viewsYesterday, 1)

deltaAds = (adsToday - adsYesterday) / max(adsYesterday, 1)

–µ—Å–ª–∏ deltaViews ‚â• 0.3 (30%) ‚Üí –ø–∏—à–µ–º TrendEvent (metric='views')

–µ—Å–ª–∏ deltaAds ‚â• 0.3 ‚Üí –ø–∏—à–µ–º TrendEvent (metric='ads')

–°—Ç–∞—Ä—ã–µ TrendEvent —Å—Ç–∞—Ä—à–µ 14‚Äì30 –¥–Ω–µ–π –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å.

3.3. API –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤

GET /api/trends/local?lat=&lng=&radiusKm=

–æ–ø—Ä–µ–¥–µ–ª—è–µ–º geoHash –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

–≤–æ–∑–≤—Ä–∞—â–∞–µ–º recent TrendEvent (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π) –ø–æ –±–ª–∏–∂–∞–π—à–∏–º –≥–µ–æ-—è—á–µ–π–∫–∞–º.

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
[
  {
    "categoryId": "fermer-potatoes",
    "categoryName": "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å",
    "metric": "views",
    "deltaPercent": 0.48,
    "label": "–°–ø—Ä–æ—Å –Ω–∞ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å –≤—ã—Ä–æ—Å –Ω–∞ 48% –∑–∞ –¥–µ–Ω—å"
  },
  {
    "categoryId": "berries",
    "categoryName": "–Ø–≥–æ–¥—ã",
    "metric": "ads",
    "deltaPercent": 0.32,
    "label": "–í—ã—Ä–æ—Å–ª–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —è–≥–æ–¥–∞–º (+32%)"
  }
]
Front:

–ù–∞ –≥–ª–∞–≤–Ω–æ–π:

–±–ª–æ–∫ "üî• –°–µ–π—á–∞—Å –ø–æ–ø—É–ª—è—Ä–Ω–æ —Ä—è–¥–æ–º"

—Å–ø–∏—Å–∫–æ–º –ø–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã.

========================================
4. –ì–û–†–Ø–ß–ò–ï –ü–û–ò–°–ö–û–í–´–ï –ó–ê–ü–†–û–°–´ (HOT SEARCH)
–¶–µ–ª—å:

–ü–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –ª—é–¥–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –∏—â—É—Ç –≤–æ–∫—Ä—É–≥,

–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å ‚Äú–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä—è–¥–æ–º‚Äù.

4.1. –ú–æ–¥–µ–ª—å SearchLog

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
interface SearchLog {
  _id: ObjectId;
  query: string;          // –∏—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
  normalizedQuery: string;// –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
  userId?: ObjectId;
  locationGeoHash: string;
  createdAt: Date;
}
–ü—Ä–∏ –ª—é–±–æ–º –ø–æ–∏—Å–∫–µ:

—Å–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å (–Ω–æ –±–µ–∑ –ª–∏—à–Ω–∏—Ö PII, —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ geoHash).

4.2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è Hot Search

Worker –∫–∞–∂–¥—ã–µ 10‚Äì30 –º–∏–Ω—É—Ç:

—Å–æ–±–∏—Ä–∞–µ—Ç SearchLog –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 6)

–≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ (locationGeoHash, normalizedQuery)

—Å—á–∏—Ç–∞–µ—Ç count

–µ—Å–ª–∏ count >= 5 ‚Üí –∑–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–≥–æ—Ä—è—á–∏–º‚Äù –≤ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏.

–°–æ–∑–¥–∞–π –∫–æ–ª–ª–µ–∫—Ü–∏—é HotSearch:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
interface HotSearch {
  _id: ObjectId;
  normalizedQuery: string;
  displayQuery: string;
  locationGeoHash: string;
  count: number;
  lastUpdatedAt: Date;
}
4.3. API

GET /api/search/hot?lat=&lng=&limit=10

–∏—â–µ–º –±–ª–∏–∂–∞–π—à–∏–µ geoHash,

–≤–æ–∑–≤—Ä–∞—â–∞–µ–º top-N –∑–∞–ø—Ä–æ—Å–æ–≤.

–û—Ç–≤–µ—Ç:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
[
  { "query": "–∫–∞—Ä—Ç–æ—à–∫–∞", "count": 12 },
  { "query": "–º–∞–ª–∏–Ω–∞", "count": 9 },
  { "query": "—Ç—Ä–∞–∫—Ç–æ—Ä", "count": 7 },
  { "query": "–∞–π—Ñ–æ–Ω", "count": 6 }
]
Front:

–ü—Ä–∏ —Ñ–æ–∫—É—Å–µ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è:

–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä—è–¥–æ–º‚Äù

—Å–ø–∏—Å–æ–∫ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å:

—Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É –õ–µ–Ω—Ç–∞,

–∏—Å–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å query –∏ —Ä–∞–¥–∏—É—Å–æ–º 3 –∫–º.

========================================
5. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –£–ú–ù–´–ú –ü–û–ò–°–ö–û–ú –ò –õ–ï–ù–¢–û–ô
–ü–æ–∏—Å–∫:

–ì–ª–æ–±–∞–ª—å–Ω—ã–π search-bar –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ:

–ø—Ä–∏ Enter:

–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–õ–µ–Ω—Ç–∞"

–∑–∞–ø—Ä–æ—Å /api/search?query=&lat=&lng=&radiusKm=3

–ø—Ä–∏ –≤–≤–æ–¥–µ:

–∑–∞–ø—Ä–æ—Å /api/search/suggest –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –º–∞—Ä–∫–∏, –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã).

–ü—Ä–∏ –ø–æ–∏—Å–∫–µ:

–∏—Å–ø–æ–ª—å–∑—É–π:

match –ø–æ title

match –ø–æ description

match –ø–æ brand

match –ø–æ autoBrand/autoModel

—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:

–ø–æ distance (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∞ –≥–µ–æ)

–∑–∞—Ç–µ–º –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∏–ª—å—Ç—Ä–∞ ‚Äú–±—Ä–µ–Ω–¥‚Äù –∏–ª–∏ ‚Äú–º–∞—Ä–∫–∞/–º–æ–¥–µ–ª—å –∞–≤—Ç–æ‚Äù:

–¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∑–∞–ø—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä—ã brand= –∏–ª–∏ autoBrand/autoModel.

========================================
6. –§–†–û–ù–¢–ï–ù–î: UX-–î–ï–¢–ê–õ–ò
–§–∏–ª—å—Ç—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¢–µ—Ö–Ω–∏–∫–∞/–¢–µ–ª–µ—Ñ–æ–Ω—ã:

–±–ª–æ–∫ ‚Äú–ë—Ä–µ–Ω–¥—ã‚Äù

–±—Ä–µ–Ω–¥—ã –≤—ã–≤–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –≤–∏–¥–∏–º—ã –≤ –ª–æ–∫–∞—Ü–∏–∏ (–ø–æ BrandStats)

–§–∏–ª—å—Ç—Ä—ã –≤ –ê–≤—Ç–æ:

Combobox ‚Äú–ú–∞—Ä–∫–∞‚Äù

Combobox ‚Äú–ú–æ–¥–µ–ª—å‚Äù

—Å–ø–∏—Å–æ–∫ –º–∞—Ä–æ–∫/–º–æ–¥–µ–ª–µ–π —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ AutoBrandStats/AutoModelStats

–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ/–ø–æ—è–≤–ª–µ–Ω–∏–µ.

–ù–∞ –≥–ª–∞–≤–Ω–æ–π:

–±–ª–æ–∫ ‚Äúüî• –°–µ–π—á–∞—Å –ø–æ–ø—É–ª—è—Ä–Ω–æ —Ä—è–¥–æ–º‚Äù ‚Äî –¥–∞–Ω–Ω—ã–µ –∏–∑ /trends/local

–±–ª–æ–∫ ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä—è–¥–æ–º‚Äù ‚Äî –¥–∞–Ω–Ω—ã–µ /search/hot

========================================
7. –û–¢–ß–Å–¢ –ü–û –ó–ê–í–ï–†–®–ï–ù–ò–Æ
–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

–ü–µ—Ä–µ—á–∏—Å–ª–∏ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:

BrandStats

AutoBrandStats, AutoModelStats

TrendEvent

SearchLog

HotSearch

–ü–µ—Ä–µ—á–∏—Å–ª–∏ –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

BrandService / BrandStatsService

AutoCategoryService

TrendService / TrendCalculator

HotSearchService

–ü–µ—Ä–µ—á–∏—Å–ª–∏ –Ω–æ–≤—ã–µ cron/worker –∑–∞–¥–∞—á–∏:

–ø–µ—Ä–µ—Å—á—ë—Ç BrandStats

–ø–µ—Ä–µ—Å—á—ë—Ç AutoBrandStats/AutoModelStats

–≥–µ–Ω–µ—Ä–∞—Ü–∏—è TrendEvent

–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HotSearch

–û–ø–∏—à–∏ –Ω–æ–≤—ã–µ API:

GET /api/categories/brands

GET /api/categories/auto/brands + /models

GET /api/trends/local

GET /api/search/hot

–ª–æ–≥–∏–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SearchLog

–î–ª—è —Ñ—Ä–æ–Ω—Ç–∞:

–≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—Ä–µ–Ω–¥—ã

–≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ-—Ñ–∏–ª—å—Ç—Ä—ã

–≥–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –∏ hot search