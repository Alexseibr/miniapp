–ü—Ä–æ–º—Ç ‚Ññ1 –¥–ª—è Codex ‚Äî API –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (iOS/Android)

üí¨ –¢–µ–∫—Å—Ç –¥–ª—è Codex (–∫–æ–ø–∏—Ä—É–µ—à—å —Ü–µ–ª–∏–∫–æ–º):

–•–æ—á—É, —á—Ç–æ–±—ã —Ç—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª –∏ –¥–æ—Ä–∞–±–æ—Ç–∞–ª backend-API –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π KETMAR Market, —Å —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ –≤ –±—É–¥—É—â–µ–º –∫ –Ω–µ–º—É –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (iOS/Android) –∏ Telegram MiniApp.

1. –û–±—â–∞—è –∏–¥–µ—è

–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–π backend –Ω–∞ Node.js + Express + MongoDB (Mongoose), —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏:

User

Category

Season

Ad

Order

–ò —É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

GET / ‚Äî health/info

GET /api/categories

GET /api/seasons

GET /api/ads

GET /api/ads/:id

POST /api/ads (—á–µ—Ä–Ω–æ–≤–æ–π)

–ù—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å API —Ç–∞–∫, —á—Ç–æ–±—ã:

–∫ –Ω–µ–º—É –±—ã–ª–æ —É–¥–æ–±–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (React Native/Flutter/Swift/Kotlin),

–±—ã–ª–æ —á—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:

–ø—É–±–ª–∏—á–Ω—ã–µ (–∞–Ω–æ–Ω–∏–º–Ω—ã–µ) —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã,

–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω/—Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è),

–±—ã–ª–∏ –ø—Ä–æ–¥—É–º–∞–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –≥–µ–æ–ø–æ–∏—Å–∫–∞, –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –∑–∞–∫–∞–∑–æ–≤, –ø—Ä–æ—Ñ–∏–ª—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

–°—á–∏—Ç–∞–π, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å:

–û–¥–Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ KETMAR Market (–æ–±—â–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å),

–í –±—É–¥—É—â–µ–º ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –µ—â—ë –Ω–∏—à–µ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –ø–æ–∫–∞ –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç.

–°–¥–µ–ª–∞–π API:

RESTful, JSON-only

–í—Å–µ –æ—Ç–≤–µ—Ç—ã ‚Äî JSON.

–°—Ç–∞—Ç—É—Å—ã HTTP: 200 / 201 / 400 / 401 / 403 / 404 / 500.

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í–∞—Ä–∏–∞–Ω—Ç 1 (–Ω–∞ –ø–µ—Ä–≤–æ–µ –≤—Ä–µ–º—è): –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ simple access-token (–Ω–∞–ø—Ä–∏–º–µ—Ä, x-user-id –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ, –∫–∞–∫ —Å—É—Ä—Ä–æ–≥–∞—Ç Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).

–í–∞—Ä–∏–∞–Ω—Ç 2 (–Ω–∞ –±—É–¥—É—â–µ–µ): –∑–∞–∫–ª–∞–¥–∫–∞ –ø–æ–¥ JWT-—Ç–æ–∫–µ–Ω—ã, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç—å —Å—É—Ä—Ä–æ–≥–∞—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, auth —á–µ—Ä–µ–∑ Telegram/phone+OTP).

–°–¥–µ–ª–∞–π middleware, –∫–æ—Ç–æ—Ä–æ–µ:

—á–∏—Ç–∞–µ—Ç Authorization: Bearer <token> –∏–ª–∏ x-user-id,

–∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Mongo –ø–æ telegramId –∏–ª–∏ _id,

–Ω–∞–≤–µ—à–∏–≤–∞–µ—Ç req.currentUser.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤

–î–ª—è —Å–ø–∏—Å–∫–æ–≤: { items: [...], total?: number }

–î–ª—è –æ—à–∏–±–æ–∫: { error: "–°–æ–æ–±—â–µ–Ω–∏–µ", code?: "ERROR_CODE" }

3. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/—É–ª—É—á—à–∏—Ç—å
3.1. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

GET /api/users/me

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User).

PUT /api/users/me

–†–∞–∑—Ä–µ—à–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:

instagram,

–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: showUsername, showPhone, showInstagram.

–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å telegramId, verifiedPhone –∑–¥–µ—Å—å.

PUT /api/users/me/location

–û–±–Ω–æ–≤–ª—è–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

lat, lng,

updatedAt.

GET /api/users/me/favorites

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π:

–ª–∏–±–æ –∫–∞–∫ —Å–ø–∏—Å–æ–∫ Ad,

–ª–∏–±–æ { items: Ad[], adIds: string[] }.

3.2. –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–ª–∞–π–∫–∏)

–°–¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:

POST /api/favorites/:adId

–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

DELETE /api/favorites/:adId

–£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ.

GET /api/favorites

–í–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö Ad (—É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ).

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

–ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ:

–ª–∏–±–æ –≤ –ø–æ–ª–µ favorites –≤–Ω—É—Ç—Ä–∏ User,

–ª–∏–±–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ Favorite { userId, adId, createdAt }.

–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –∏ —Ä–µ–∞–ª–∏–∑—É–π –º–æ–¥–µ–ª–∏ + –º–∞—Ä—à—Ä—É—Ç—ã.

3.3. –ì–µ–æ–ø–æ–∏—Å–∫ (nearby)

–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:

GET /api/ads/nearby

Query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

lat (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π),

lng (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π),

radiusKm (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –∫–º),

categoryId (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),

subcategoryId (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),

limit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50).

–õ–æ–≥–∏–∫–∞:

–∏—Å–∫–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º location,

–≤—ã—á–∏—Å–ª—è—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç lat/lng –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –¥–æ Ad.location,

–æ—Ç–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è,

–≤ –æ—Ç–≤–µ—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ:

distanceKm (—á–∏—Å–ª–æ, –æ–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–µ –¥–æ 0.1‚Äì0.5 –∫–º).

–ù–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

–ª–∏–±–æ —á–µ—Ä–µ–∑ $geoNear (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º GeoJSON),

–ª–∏–±–æ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—É—é —Ñ–æ—Ä–º—É–ª—É ‚Äú–Ω–∞ –ø–∞–ª—å—Ü–∞—Ö‚Äù (HAVERSINE) –≤ Node.js, —Ñ–∏–ª—å—Ç—Ä—É—è –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

3.4. –§–∏–ª—å—Ç—Ä ‚Äú—Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∫–æ –º–Ω–µ‚Äù

–î–æ–±–∞–≤—å —Ñ–ª–∞–≥:

deliveryAvailableToMe: boolean –≤ –æ—Ç–≤–µ—Ç–µ /api/ads/nearby:

true, –µ—Å–ª–∏:

deliveryType –≤–∫–ª—é—á–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É,

distanceKm <= deliveryRadiusKm.

–ò —Å–¥–µ–ª–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä:

deliveryToMe=true –≤ /api/ads/nearby, —á—Ç–æ–±—ã –æ—Ç–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∞–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

3.5. –û–±—ä—è–≤–ª–µ–Ω–∏—è: —Å–ø–∏—Å–æ–∫ + –ø–∞–≥–∏–Ω–∞—Ü–∏—è + —Ñ–∏–ª—å—Ç—Ä—ã

–£—Ç–æ—á–Ω–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç GET /api/ads:

Query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

categoryId,

subcategoryId,

seasonCode,

limit,

offset –∏–ª–∏ page.

–î–æ–±–∞–≤—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É:

sort=createdAt_desc (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é),

–≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å.

–î–æ–ø–æ–ª–Ω–∏ –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∞:

{ items: Ad[], total?: number }

–≥–¥–µ total ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–∑–∂–µ, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–¥—É–º–∞–π —Å—Ä–∞–∑—É).

4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ü–µ–Ω—ã/—Å—Ç–∞—Ç—É—Å–∞ (API-–æ—Å–Ω–æ–≤–∞)

–ü–æ–¥–≥–æ—Ç–æ–≤—å API-—Å–ª–æ–π ‚Äú–Ω–∞ –±—É–¥—É—â–µ–µ‚Äù, —á—Ç–æ–±—ã –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥–ª–∏ –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π –º–æ–¥–µ–ª—å Ad, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã –∏ —Å—Ç–∞—Ç—É—Å–∞:

priceHistory: [{ oldPrice, newPrice, changedAt }]

statusHistory: [{ oldStatus, newStatus, changedAt }]

–°–¥–µ–ª–∞–π —Ö–µ–ª–ø–µ—Ä—ã:

updateAdPrice(adId, newPrice)

updateAdStatus(adId, newStatus)

—á—Ç–æ–±—ã –æ–Ω–∏:

–∏–∑–º–µ–Ω—è–ª–∏ –ø–æ–ª–µ,

–ø—É—à–∏–ª–∏ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é.

–î–æ–±–∞–≤—å –ø—Ä–æ—Å—Ç–æ–π endpoint:

GET /api/ads/:id/history

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–ª—è —Ç–µ—Å—Ç–∞/–æ—Ç–ª–∞–¥–∫–∏).

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (push/Telegram) –º–æ–∂–Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, –≥–ª–∞–≤–Ω–æ–µ ‚Äî API –∏ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö.

5. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CommonJS (require, module.exports).

–†–∞–∑–Ω–µ—Å—Ç–∏ –∫–æ–¥:

/models,

/api/routes,

/services (—Ö–µ–ª–ø–µ—Ä—ã),

/middleware (auth).

–î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π).

–í –∫–∞–∂–¥–æ–º —Ä–æ—É—Ç–µ –¥–µ–ª–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (try/catch) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å.

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:

–ú–æ–¥–µ–ª–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è).

Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (authMiddleware.js).

–ù–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:

/api/users/me, /api/users/me/location

/api/favorites*

/api/ads/nearby

–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç /api/ads —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

–•–µ–ª–ø–µ—Ä—ã updateAdPrice, updateAdStatus –∏ /api/ads/:id/history.