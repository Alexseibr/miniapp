import{h as g,u as h,j as e,E as c}from"./index-C0UB_dVU.js";import{r as o}from"./vendor-react-C4_xJuq0.js";import{f as x}from"./time-DsfvQ_7m.js";import"./vendor-ui-DiZGdpRh.js";async function y(s){return(await g.get("/api/orders/my",{params:{buyerTelegramId:s}})).data}const j=[{_id:"demo-order-1",status:"new",seasonCode:"demo",createdAt:new Date().toISOString(),items:[{adId:"demo-1",title:"Тестовая корзина",price:12,quantity:2},{adId:"demo-2",title:"Демо ягоды",price:8,quantity:1}]}];function S(s){switch(s){case"new":return"Новый";case"processed":return"В работе";case"completed":return"Завершён";case"cancelled":return"Отменён";case"expired":return"Истёк";default:return s}}function b(s){return s.items.reduce((n,a)=>n+(a.price||0)*(a.quantity||0),0)}function v(){const s=h(t=>t.user),[n,a]=o.useState([]),[p,l]=o.useState(!1),[d,u]=o.useState(null);o.useEffect(()=>{async function t(){if(s?.telegramId){l(!0),u(null);try{const i=await y(s.telegramId);a(i.items||[])}catch(i){console.error("orders fetch error",i),u("Не удалось загрузить заказы"),a(j)}finally{l(!1)}}}t()},[s?.telegramId]);const f=o.useMemo(()=>n.length>0,[n]);return s?p?e.jsx(c,{title:"Загружаем ваши заказы"}):f?e.jsxs("div",{className:"container",children:[e.jsx("h2",{style:{marginTop:0,marginBottom:12},children:"Мои заказы"}),d&&e.jsxs("div",{role:"status",style:{marginBottom:12,padding:12,borderRadius:12,background:"#fff7ed",color:"#9a3412"},children:[d," (показаны демо-данные)"]}),e.jsx("div",{className:"stack",style:{gap:12},children:n.map(t=>{const i=b(t),m=t.createdAt?x(t.createdAt):"";return e.jsxs("article",{className:"card",children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("p",{className:"badge",style:{marginBottom:6},children:["#",t._id]}),e.jsx("p",{style:{margin:0,fontWeight:600},children:S(t.status)}),m&&e.jsxs("p",{style:{margin:"4px 0",color:"#475467",fontSize:"0.9rem"},children:["Создан ",m]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("p",{style:{margin:0,color:"#111827",fontWeight:700},children:[i.toFixed(2)," BYN"]}),e.jsxs("p",{style:{margin:0,color:"#475467",fontSize:"0.9rem"},children:[t.items.length," поз."]})]})]}),t.seasonCode&&e.jsxs("p",{style:{margin:"6px 0 12px",color:"#475467",fontSize:"0.9rem"},children:["Сезон: ",t.seasonCode]}),e.jsx("ul",{style:{paddingLeft:18,margin:0,color:"#111827"},children:t.items.map(r=>e.jsxs("li",{style:{marginBottom:4},children:[e.jsx("span",{children:r.title||"Объявление"}),typeof r.quantity=="number"&&e.jsxs("span",{style:{color:"#475467"},children:[" — ",r.quantity," шт."]}),typeof r.price=="number"&&e.jsxs("span",{style:{marginLeft:6,color:"#111827",fontWeight:600},children:[(r.price*(r.quantity||1)).toFixed(2)," BYN"]})]},`${t._id}-${r.adId}`))})]},t._id)})})]}):e.jsx(c,{title:"У вас пока нет заказов",description:"Оформите заказ из карточки объявления"}):e.jsx(c,{title:"Войдите через Telegram",description:"Откройте MiniApp из чата с ботом, чтобы увидеть свои заказы"})}export{v as default};
