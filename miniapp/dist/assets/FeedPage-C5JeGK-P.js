import{c as R,j as e,P as B,a as L,f as A,E as D}from"./index-DK3NXmw2.js";import{r as s,L as N,u as $}from"./vendor-react-C4_xJuq0.js";import{l as E,a as F}from"./ads-DNDRIolR.js";import{A as T}from"./AdCard-BV-nbh2l.js";import{f as M}from"./seasons-Bq8eZYD8.js";import{u as q}from"./geo-DM2aOsZY.js";import"./vendor-ui-DiZGdpRh.js";import"./cart-CX-AQXQJ.js";import"./time-DsfvQ_7m.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=R("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=R("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),H=[{value:"newest",label:"По новизне"},{value:"cheapest",label:"По возрастанию цены"},{value:"expensive",label:"По убыванию цены"},{value:"popular",label:"По популярности"},{value:"distance",label:"По расстоянию"}];function U({isOpen:r,onClose:n,minPrice:t,maxPrice:p,sort:o,onMinPriceChange:c,onMaxPriceChange:x,onSortChange:g,onRequestLocation:f,coords:k,radiusKm:u,onRadiusChange:b,geoStatus:j,totalAds:v}){const[S,w]=s.useState(t),[z,m]=s.useState(p),[l,y]=s.useState(o),[C,h]=s.useState(u);s.useEffect(()=>(r?(w(t),m(p),y(o),h(u),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r,t,p,o,u]);const I=()=>{c(S),x(z),g(l),b(C),l==="distance"&&!k&&f(),n()},d=()=>{w(""),m(""),y("newest"),h(5),c(""),x(""),g("newest"),b(5)};return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,animation:"fadeIn 0.2s"},onClick:n,"data-testid":"filter-overlay"}),e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"white",zIndex:1e3,display:"flex",flexDirection:"column",animation:"slideInRight 0.3s"},"data-testid":"filter-drawer",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",borderBottom:"1px solid #e5e7eb",backgroundColor:"white"},children:[e.jsx("button",{type:"button",onClick:n,style:{background:"none",border:"none",padding:8,cursor:"pointer",display:"flex",alignItems:"center"},"data-testid":"button-close-filters",children:e.jsx(O,{size:24,color:"#111827"})}),e.jsx("h2",{style:{margin:0,fontSize:17,fontWeight:600},"data-testid":"text-filter-title",children:"Фильтр"}),e.jsx("button",{type:"button",onClick:d,style:{background:"none",border:"none",padding:8,cursor:"pointer",fontSize:15,color:"#10b981",fontWeight:500},"data-testid":"button-reset-filters",children:"Сбросить"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:16},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{style:{margin:"0 0 10px",fontSize:14,fontWeight:600,color:"#111827"},"data-testid":"text-price-label",children:"Цена"}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{className:"input",type:"number",placeholder:"от",value:S,onChange:a=>w(a.target.value),style:{fontSize:14,padding:"10px 12px"},"data-testid":"input-min-price-drawer",min:"0"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{className:"input",type:"number",placeholder:"до",value:z,onChange:a=>m(a.target.value),style:{fontSize:14,padding:"10px 12px"},"data-testid":"input-max-price-drawer",min:"0"}),e.jsx("div",{style:{fontSize:13,color:"#6b7280",marginTop:4,textAlign:"right"},children:"р."})]})]})]}),l==="distance"&&e.jsxs("div",{style:{marginBottom:20,paddingTop:16,borderTop:"1px solid #f3f4f6"},children:[e.jsx("h3",{style:{margin:"0 0 10px",fontSize:14,fontWeight:600,color:"#111827"},"data-testid":"text-radius-label",children:"Радиус поиска"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[e.jsx("input",{type:"range",min:1,max:50,step:1,value:C,onChange:a=>h(Number(a.target.value)),style:{flex:1},"data-testid":"slider-radius"}),e.jsxs("span",{style:{fontSize:14,fontWeight:600,minWidth:60},"data-testid":"text-radius-value",children:[C," км"]})]}),j!=="ready"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{style:{margin:"8px 0",fontSize:13,color:"#6b7280"},"data-testid":"text-geo-status",children:j==="loading"?"Получаем координаты…":"Включите геолокацию для поиска рядом"}),j==="idle"&&e.jsx("button",{type:"button",onClick:f,style:{padding:"8px 16px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:6,fontSize:13,fontWeight:500,cursor:"pointer",marginTop:8},"data-testid":"button-request-location",children:"Включить геолокацию"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 0",marginTop:16},children:[e.jsx("span",{style:{fontSize:14,color:"#111827"},children:"Сортировать"}),e.jsx("select",{value:l,onChange:a=>y(a.target.value),style:{fontSize:14,color:"#10b981",border:"none",background:"none",fontWeight:500,cursor:"pointer"},"data-testid":"select-sort",children:H.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsx("div",{style:{padding:16,borderTop:"1px solid #e5e7eb",backgroundColor:"white"},children:e.jsxs("button",{type:"button",onClick:I,style:{width:"100%",padding:"14px 16px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:8,fontSize:15,fontWeight:600,cursor:"pointer"},"data-testid":"button-apply-filters",children:["Показать ",v>0?`${v.toLocaleString("ru-RU")} `:"","объявлений"]})}),e.jsx("style",{children:`
          @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
          }
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
        `})]})]}):null}function _(){const[r,n]=s.useState([]);return s.useEffect(()=>{M().then(t=>{const p=t.filter(o=>{if(!o.startDate||!o.endDate)return!1;const c=new Date,x=new Date(o.startDate),g=new Date(o.endDate);return c>=x&&c<=g});n(p.slice(0,5))}).catch(console.error)},[]),r.length===0?null:e.jsx("div",{style:{display:"flex",gap:12,overflowX:"auto",paddingBottom:12,scrollSnapType:"x mandatory"},"data-testid":"season-banners",children:r.map((t,p)=>{const o=[{start:"#6366f1",end:"#4f46e5"},{start:"#f59e0b",end:"#d97706"},{start:"#10b981",end:"#059669"},{start:"#ef4444",end:"#dc2626"},{start:"#8b5cf6",end:"#7c3aed"}],c=o[p%o.length];return e.jsxs(N,{to:`/feed?season=${t.code}`,style:{minWidth:280,height:140,borderRadius:16,background:`linear-gradient(135deg, ${c.start} 0%, ${c.end} 100%)`,padding:20,color:"white",textDecoration:"none",display:"flex",flexDirection:"column",justifyContent:"space-between",scrollSnapAlign:"start",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},"data-testid":`season-banner-${t.code}`,children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},"data-testid":`text-season-name-${t.code}`,children:t.name}),t.description&&e.jsxs("p",{style:{margin:"4px 0 0",fontSize:13,opacity:.9},"data-testid":`text-season-description-${t.code}`,children:[t.description.slice(0,60),t.description.length>60?"...":""]})]}),e.jsx("div",{style:{fontSize:11,opacity:.8},"data-testid":`text-season-cta-${t.code}`,children:"Смотреть предложения →"})]},t.code)})})}function G({categories:r}){if(!r.length)return null;const n=t=>L[t]||null;return e.jsx("div",{style:{display:"flex",gap:12,overflowX:"auto",padding:"12px 0",scrollbarWidth:"none",msOverflowStyle:"none"},className:"category-scroll",children:r.map(t=>e.jsxs(N,{to:`/feed?categoryId=${encodeURIComponent(t.slug)}`,"data-testid":`category-${t.slug}`,style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:100,textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{width:80,height:80,borderRadius:20,backgroundColor:"#F5F7FA",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8,boxShadow:"0 1px 3px rgba(0, 0, 0, 0.06)",overflow:"hidden"},children:n(t.slug)?e.jsx("img",{src:n(t.slug),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover"},"data-testid":`category-icon-${t.slug}`}):e.jsx(B,{size:40,strokeWidth:1.5,color:"#9ca3af","data-testid":`category-icon-fallback-${t.slug}`})}),e.jsx("span",{style:{fontSize:"0.75rem",textAlign:"center",color:"#111827",fontWeight:500,lineHeight:1.2},children:t.name})]},t.slug))})}function se(){const{search:r}=$(),n=s.useMemo(()=>new URLSearchParams(r),[r]),[t,p]=s.useState([]),[o,c]=s.useState(()=>{const i=n.get("sort");return i&&["newest","cheapest","expensive","popular","distance"].includes(i)?i:"newest"}),[x,g]=s.useState(()=>n.get("q")||""),[f,k]=s.useState(()=>n.get("minPrice")||""),[u,b]=s.useState(()=>n.get("maxPrice")||""),[j,v]=s.useState(!0),[S,w]=s.useState([]),[z,m]=s.useState(!1),{coords:l,requestLocation:y,status:C,radiusKm:h,setRadius:I}=q();s.useEffect(()=>{A().then(w).catch(console.error)},[]),s.useEffect(()=>{const i=n.get("sort");i&&["newest","cheapest","expensive","popular","distance"].includes(i)&&c(i),g(n.get("q")||""),k(n.get("minPrice")||""),b(n.get("maxPrice")||"")},[r]);const d=s.useMemo(()=>({sort:o,search:x,minPrice:f?Number(f):void 0,maxPrice:u?Number(u):void 0,categoryId:n.get("categoryId")||void 0,subcategoryId:n.get("subcategoryId")||void 0,seasonCode:n.get("season")||void 0}),[o,x,f,u,n]);s.useEffect(()=>{let i=!1;async function P(){v(!0);try{const W=o==="distance"&&l?await E({lat:l.lat,lng:l.lng,radiusKm:h,sort:"distance",q:x,limit:40,minPrice:d.minPrice,maxPrice:d.maxPrice,categoryId:d.categoryId,subcategoryId:d.subcategoryId,seasonCode:d.seasonCode}):await F({sort:o,q:x,limit:40,lat:l?.lat,lng:l?.lng,minPrice:d.minPrice,maxPrice:d.maxPrice,categoryId:d.categoryId,subcategoryId:d.subcategoryId,seasonCode:d.seasonCode});i||p(W.items||[])}catch(W){console.error("feed error",W),i||p([])}finally{i||v(!1)}}return P(),()=>{i=!0}},[d,l,h]);const a=s.useMemo(()=>S.slice(0,6),[S]);return e.jsxs("div",{children:[e.jsx("div",{style:{position:"sticky",top:0,backgroundColor:"white",zIndex:10,padding:"10px 16px",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("div",{style:{position:"relative",flex:1},children:e.jsx("input",{className:"input",type:"search",placeholder:"Поиск объявлений",value:x,onChange:i=>g(i.target.value),"data-testid":"input-search",style:{fontSize:15,padding:"10px 14px"}})}),e.jsx("button",{type:"button",onClick:()=>m(!0),"data-testid":"button-open-filters",style:{padding:10,backgroundColor:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:40,height:40},children:e.jsx(X,{size:20,color:"#6b7280"})})]})}),e.jsxs("div",{style:{padding:16},children:[a.length>0&&e.jsx("div",{style:{marginBottom:16},children:e.jsx(G,{categories:a})}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(_,{})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,overflowX:"auto",paddingBottom:4},children:[e.jsx("button",{className:"secondary",style:{whiteSpace:"nowrap",padding:"7px 14px",fontSize:13},"data-testid":"button-filter-categories",children:"Категории"}),e.jsx("button",{className:"secondary",style:{whiteSpace:"nowrap",padding:"7px 14px",fontSize:13},"data-testid":"button-filter-location",children:"Вся Беларусь"}),e.jsx("button",{className:"secondary",style:{whiteSpace:"nowrap",padding:"7px 14px",fontSize:13},"data-testid":"button-filter-sort",children:"По новизне"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:16},children:[e.jsxs("button",{className:"primary",style:{padding:"14px",textAlign:"left",display:"flex",flexDirection:"column",gap:4},"data-testid":"button-all-ads",children:[e.jsx("span",{style:{fontSize:15,fontWeight:600},children:"Всего"}),e.jsxs("span",{style:{fontSize:13,opacity:.9},children:[t.length," объявлений"]})]}),e.jsxs("button",{className:"primary",style:{padding:"14px",textAlign:"left",display:"flex",flexDirection:"column",gap:4,backgroundColor:"#10b981"},"data-testid":"button-company-ads",children:[e.jsx("span",{style:{fontSize:15,fontWeight:600},children:"Товары компаний"}),e.jsx("span",{style:{fontSize:13,opacity:.9},children:"0 объявлений"})]})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx("h2",{style:{margin:0,fontSize:16,fontWeight:600},"data-testid":"text-all-ads-title",children:"Все объявления"})}),j?e.jsx(D,{title:"Загружаем объявления",description:"Подождите немного"}):t.length?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:t.map(i=>e.jsx(T,{ad:i},i._id))}):e.jsx(D,{title:"Объявлений не найдено",description:"Попробуйте изменить фильтры или выбрать другую категорию",action:o==="distance"?e.jsx("button",{type:"button",className:"secondary",onClick:y,"data-testid":"button-update-location",children:"Обновить координаты"}):void 0})]}),e.jsx(U,{isOpen:z,onClose:()=>m(!1),minPrice:f,maxPrice:u,sort:o,onMinPriceChange:k,onMaxPriceChange:b,onSortChange:i=>{c(i),i==="distance"&&!l&&y()},onRequestLocation:y,coords:l,radiusKm:h,onRadiusChange:I,geoStatus:C,totalAds:t.length})]})}export{se as default};
