export const ICON_3D_KEYWORD_MAP = {
  'home_cleaning': {
    keywords: ['–ø–æ—Ä–æ—à–æ–∫', '—Å—Ç–∏—Ä–∞–ª—å–Ω—ã–π', '—á–∏—Å—Ç—è—â–µ–µ', '–º–æ—é—â–µ–µ', '–æ—Ç–±–µ–ª–∏–≤–∞—Ç–µ–ª—å', '–ø—è—Ç–Ω–æ–≤—ã–≤–æ–¥–∏—Ç–µ–ª—å'],
    icon3d: '/attached_assets/generated_images/cleaning_supplies_3d.png',
    fallbackIcon: 'üß¥'
  },
  'coffee_tea': {
    keywords: ['–∫–æ—Ñ–µ', '—á–∞–π', '–∑–µ—Ä–Ω–∞', '–º–æ–ª–æ—Ç—ã–π', '—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π', '–ø—É—ç—Ä', '—É–ª—É–Ω'],
    icon3d: '/attached_assets/generated_images/coffee_cup_3d.png',
    fallbackIcon: '‚òï'
  },
  'bikes': {
    keywords: ['–≤–µ–ª–æ—Å–∏–ø–µ–¥', '–±–∞–π–∫', 'bmx', '–≥–æ—Ä–Ω—ã–π', '—à–æ—Å—Å–µ–π–Ω—ã–π', '—Å–∞–º–æ–∫–∞—Ç'],
    icon3d: '/attached_assets/generated_images/bicycle_3d.png',
    fallbackIcon: 'üö≤'
  },
  'tools': {
    keywords: ['–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç', '–¥—Ä–µ–ª—å', '—à—É—Ä—É–ø–æ–≤—ë—Ä—Ç', '–º–æ–ª–æ—Ç–æ–∫', '–æ—Ç–≤—ë—Ä—Ç–∫–∞', '–∫–ª—é—á'],
    icon3d: '/attached_assets/generated_images/tools_3d.png',
    fallbackIcon: 'üîß'
  },
  'kitchen': {
    keywords: ['–ø–æ—Å—É–¥–∞', '–∫–∞—Å—Ç—Ä—é–ª—è', '—Å–∫–æ–≤–æ—Ä–æ–¥–∞', '—Ç–∞—Ä–µ–ª–∫–∞', '—á–∞—à–∫–∞', '–∫—É—Ö–æ–Ω–Ω—ã–π'],
    icon3d: '/attached_assets/generated_images/kitchen_items_3d.png',
    fallbackIcon: 'üç≥'
  },
  'clothes_accessories': {
    keywords: ['—Å—É–º–∫–∞', '—á–∞—Å—ã', '–æ—á–∫–∏', '—Ä–µ–º–µ–Ω—å', '—à–∞—Ä—Ñ', '–∞–∫—Å–µ—Å—Å—É–∞—Ä'],
    icon3d: '/attached_assets/generated_images/accessories_3d.png',
    fallbackIcon: 'üëú'
  },
  'books_media': {
    keywords: ['–∫–Ω–∏–≥–∞', '—É—á–µ–±–Ω–∏–∫', '–∂—É—Ä–Ω–∞–ª', '–¥–∏—Å–∫', 'dvd', '–ø–ª–∞—Å—Ç–∏–Ω–∫–∞'],
    icon3d: '/attached_assets/generated_images/books_3d.png',
    fallbackIcon: 'üìö'
  },
  'sports_equipment': {
    keywords: ['–≥–∞–Ω—Ç–µ–ª–∏', '—à—Ç–∞–Ω–≥–∞', '—Ç—Ä–µ–Ω–∞–∂—ë—Ä', '–º—è—á', '—Ä–∞–∫–µ—Ç–∫–∞', '–ª—ã–∂–∏', '–∫–æ–Ω—å–∫–∏'],
    icon3d: '/attached_assets/generated_images/sports_equipment_3d.png',
    fallbackIcon: 'üèãÔ∏è'
  },
  'cosmetics': {
    keywords: ['–∫—Ä–µ–º', '—à–∞–º–ø—É–Ω—å', '–¥—É—Ö–∏', '–ø–æ–º–∞–¥–∞', '—Ç—É—à—å', '–ø–∞—Ä—Ñ—é–º', '–∫–æ—Å–º–µ—Ç–∏–∫–∞'],
    icon3d: '/attached_assets/generated_images/cosmetics_3d.png',
    fallbackIcon: 'üíÑ'
  },
  'garden': {
    keywords: ['—Å–∞–¥–æ–≤—ã–π', '—Ä–∞—Å—Å–∞–¥–∞', '—É–¥–æ–±—Ä–µ–Ω–∏–µ', '–ª–æ–ø–∞—Ç–∞', '–≥—Ä–∞–±–ª–∏', '—à–ª–∞–Ω–≥'],
    icon3d: '/attached_assets/generated_images/garden_tools_3d.png',
    fallbackIcon: 'üå±'
  },
  'baby_items': {
    keywords: ['–ø–µ–ª—ë–Ω–∫–∞', '—Å–æ—Å–∫–∞', '–±—É—Ç—ã–ª–æ—á–∫–∞', '–ø–∞–º–ø–µ—Ä—Å', '–ø–æ–¥–≥—É–∑–Ω–∏–∫', '–º–∞–Ω–µ–∂'],
    icon3d: '/attached_assets/generated_images/baby_items_3d.png',
    fallbackIcon: 'üë∂'
  },
  'antiques': {
    keywords: ['–∞–Ω—Ç–∏–∫–≤–∞—Ä–∏–∞—Ç', '–≤–∏–Ω—Ç–∞–∂', '—Å—Ç–∞—Ä–∏–Ω–Ω—ã–π', '–∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π', '—Ä–∞—Ä–∏—Ç–µ—Ç'],
    icon3d: '/attached_assets/generated_images/antiques_3d.png',
    fallbackIcon: 'üè∫'
  },
  'music_instruments': {
    keywords: ['–≥–∏—Ç–∞—Ä–∞', '–ø–∏–∞–Ω–∏–Ω–æ', '—Å–∫—Ä–∏–ø–∫–∞', '–±–∞—Ä–∞–±–∞–Ω', '—Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä', '–º—É–∑—ã–∫–∞–ª—å–Ω—ã–π'],
    icon3d: '/attached_assets/generated_images/music_instruments_3d.png',
    fallbackIcon: 'üé∏'
  },
  'camping': {
    keywords: ['–ø–∞–ª–∞—Ç–∫–∞', '—Å–ø–∞–ª—å–Ω–∏–∫', '—Ä—é–∫–∑–∞–∫', '—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π', '–ø–æ—Ö–æ–¥–Ω—ã–π', '—Ç–µ—Ä–º–æ—Å'],
    icon3d: '/attached_assets/generated_images/camping_gear_3d.png',
    fallbackIcon: '‚õ∫'
  },
  'fishing': {
    keywords: ['—É–¥–æ—á–∫–∞', '—Å–ø–∏–Ω–Ω–∏–Ω–≥', '–∫–∞—Ç—É—à–∫–∞', '—Ä—ã–±–æ–ª–æ–≤–Ω—ã–π', '–ª–æ–¥–∫–∞', '—ç—Ö–æ–ª–æ—Ç'],
    icon3d: '/attached_assets/generated_images/fishing_gear_3d.png',
    fallbackIcon: 'üé£'
  },
  'handmade': {
    keywords: ['—Ä—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞', '—Ö–µ–Ω–¥–º–µ–π–¥', 'handmade', '–≤—è–∑–∞–Ω—ã–π', '—Å—à–∏—Ç—ã–π', '–∞–≤—Ç–æ—Ä—Å–∫–∏–π'],
    icon3d: '/attached_assets/generated_images/handmade_3d.png',
    fallbackIcon: 'üß∂'
  },
  'office': {
    keywords: ['–æ—Ñ–∏—Å–Ω—ã–π', '–∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è', '–ø—Ä–∏–Ω—Ç–µ—Ä', '–∫–∞—Ä—Ç—Ä–∏–¥–∂', '–±—É–º–∞–≥–∞', '–ø–∞–ø–∫–∞'],
    icon3d: '/attached_assets/generated_images/office_supplies_3d.png',
    fallbackIcon: 'üìé'
  },
  'medical': {
    keywords: ['–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π', '–∞–ø—Ç–µ—á–∫–∞', '—Ç–æ–Ω–æ–º–µ—Ç—Ä', '–∏–Ω–≥–∞–ª—è—Ç–æ—Ä', '–º–∞—Å—Å–∞–∂—ë—Ä', '–æ—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–π'],
    icon3d: '/attached_assets/generated_images/medical_equipment_3d.png',
    fallbackIcon: 'üíä'
  },
  'lighting': {
    keywords: ['–ª—é—Å—Ç—Ä–∞', '—Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫', '–ª–∞–º–ø–∞', '–±—Ä–∞', '—Ç–æ—Ä—à–µ—Ä', '–æ—Å–≤–µ—â–µ–Ω–∏–µ'],
    icon3d: '/attached_assets/generated_images/lighting_3d.png',
    fallbackIcon: 'üí°'
  },
  'textile': {
    keywords: ['–ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ', '–æ–¥–µ—è–ª–æ', '–ø–æ–¥—É—à–∫–∞', '–ø–ª–µ–¥', '—à—Ç–æ—Ä—ã', '–ø–æ–ª–æ—Ç–µ–Ω—Ü–µ'],
    icon3d: '/attached_assets/generated_images/textile_3d.png',
    fallbackIcon: 'üõèÔ∏è'
  },
  'food': {
    keywords: ['–ø—Ä–æ–¥—É–∫—Ç—ã', '–µ–¥–∞', '—Å–Ω–µ–∫–∏', '—Å–ª–∞–¥–æ—Å—Ç–∏', '–∫–æ–Ω—Ñ–µ—Ç—ã', '–ø–µ—á–µ–Ω—å–µ'],
    icon3d: '/attached_assets/generated_images/food_3d.png',
    fallbackIcon: 'üçé'
  },
  'drinks': {
    keywords: ['–Ω–∞–ø–∏—Ç–æ–∫', '–≤–æ–¥–∞', '—Å–æ–∫', '–ª–∏–º–æ–Ω–∞–¥', '–≥–∞–∑–∏—Ä–æ–≤–∫–∞'],
    icon3d: '/attached_assets/generated_images/drinks_3d.png',
    fallbackIcon: 'ü•§'
  },
  'default_other': {
    keywords: [],
    icon3d: '/attached_assets/generated_images/box_3d.png',
    fallbackIcon: 'üì¶'
  }
};

export const PARENT_CATEGORY_FALLBACKS = {
  'dom-sad': {
    icon3d: '/attached_assets/generated_images/home_garden_icon.png',
    slug: 'dom-sad'
  },
  'other': {
    icon3d: '/attached_assets/generated_images/box_3d.png',
    slug: 'inoe'
  },
  'elektronika': {
    icon3d: '/attached_assets/generated_images/electronics_devices_icon.png',
    slug: 'elektronika'
  },
  'bytovaya-tehnika': {
    icon3d: '/attached_assets/generated_images/appliances_icon.png',
    slug: 'bytovaya-tehnika'
  },
  'hobbi-sport-turizm': {
    icon3d: '/attached_assets/generated_images/hobby_sport_icon.png',
    slug: 'hobbi-sport-turizm'
  },
  'odezhda-obuv': {
    icon3d: '/attached_assets/generated_images/clothes_fashion_icon.png',
    slug: 'odezhda-obuv'
  },
  'krasota-zdorove-tovary': {
    icon3d: '/attached_assets/generated_images/beauty_health_icon.png',
    slug: 'krasota-zdorove-tovary'
  },
  'tovary-dlya-detey': {
    icon3d: '/attached_assets/generated_images/kids_baby_icon.png',
    slug: 'tovary-dlya-detey'
  },
  'farmer-market': {
    icon3d: '/attached_assets/generated_images/farm_market_icon.png',
    slug: 'farmer-market'
  }
};

export function findIcon3dByKeywords(text) {
  const normalizedText = text.toLowerCase();
  
  for (const [code, config] of Object.entries(ICON_3D_KEYWORD_MAP)) {
    if (code === 'default_other') continue;
    
    for (const keyword of config.keywords) {
      if (normalizedText.includes(keyword.toLowerCase())) {
        return {
          code,
          icon3d: config.icon3d,
          matchedKeyword: keyword
        };
      }
    }
  }
  
  return {
    code: 'default_other',
    icon3d: ICON_3D_KEYWORD_MAP.default_other.icon3d,
    matchedKeyword: null
  };
}

export function generateSubcategorySlug(parentSlug, keywords) {
  const mainKeyword = keywords[0] || 'other';
  const normalized = mainKeyword
    .toLowerCase()
    .replace(/[^a-z–∞-—è—ë0-9]/gi, '-')
    .replace(/-+/g, '-')
    .replace(/^-|-$/g, '');
  
  const translitMap = {
    '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo',
    '–∂': 'zh', '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm',
    '–Ω': 'n', '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u',
    '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts', '—á': 'ch', '—à': 'sh', '—â': 'sch', '—ä': '',
    '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya'
  };
  
  const transliterated = normalized
    .split('')
    .map(char => translitMap[char] || char)
    .join('');
  
  return `${parentSlug}-${transliterated}`.slice(0, 50);
}

export function generateSubcategoryTitle(keywords) {
  if (!keywords || keywords.length === 0) return '–î—Ä—É–≥–æ–µ';
  
  const mainKeyword = keywords[0];
  return mainKeyword.charAt(0).toUpperCase() + mainKeyword.slice(1);
}
